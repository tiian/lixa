/*
 * Copyright (c) 2009-2012, Christian Ferrari <tiian@users.sourceforge.net>
 * All rights reserved.
 *
 * This file is part of LIXA.
 *
 * LIXA is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as published
 * by the Free Software Foundation.
 *
 * LIXA is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with LIXA.  If not, see <http://www.gnu.org/licenses/>.
 */
#include <config.h>



#ifdef HAVE_STDIO_H
# include <stdio.h>
#endif
#ifdef HAVE_STDLIB_H
# include <stdlib.h>
#endif
#ifdef HAVE_GLIB_H
# include <glib.h>
#endif



/* this utility program is useful to retrieve LIXA configuration from
   command line */


#define OUTPUT_FORMAT "%s\n"
#define CFLAGS_STRING "-Wall"
#define CONFIG_DIR_STRING "@LIXA_CONFIG_SYSCONFDIR@"
#define CPPFLAGS_STRING "-I@LIXA_CONFIG_INCLUDEDIR@"
#define INCLUDE_STRING "@LIXA_CONFIG_INCLUDEDIR@"
#define LDFLAGS_STRING "-Wl,-rpath -Wl,@LIXA_CONFIG_LIBDIR@"
#define LIB_DIR_STRING "@LIXA_CONFIG_LIBDIR@"
#define LIBS_STRING "-L@LIXA_CONFIG_LIBDIR@ -llixac"
#ifdef HAVE_POSTGRESQL
# define INCLUDE_DIR_POSTGRESQL_STRING "@POSTGRESQL_INCLUDE_DIR@"
# define LIBS_POSTGRESQL_STRING "-L@LIXA_CONFIG_LIBDIR@ -llixac -llixapq"
#endif
#ifdef HAVE_MYSQL
# define INCLUDE_DIR_MYSQL_STRING "@MYSQL_INCLUDE_DIR@"
# define LIBS_MYSQL_STRING "-L@LIXA_CONFIG_LIBDIR@ -llixac -llixamy"
#endif
#define PREFIX_STRING "@LIXA_CONFIG_PREFIX@"
#define STATE_DIR_STRING "@LIXA_CONFIG_LOCALSTATEDIR@"



/* default command line options */
static gboolean cflags = FALSE;
static gboolean config_dir = FALSE;
static gboolean cppflags = FALSE;
static gboolean include_dir = FALSE;
static gboolean ldflags = FALSE;
static gboolean lib_dir = FALSE;
static gboolean libs = FALSE;
#ifdef HAVE_POSTGRESQL
static gboolean include_dir_postgresql = FALSE;
static gboolean libs_postgresql = FALSE;
#endif
#ifdef HAVE_MYSQL
static gboolean include_dir_mysql = FALSE;
static gboolean libs_mysql = FALSE;
#endif
static gboolean prefix = FALSE;
static gboolean state_dir = FALSE;
static GOptionEntry entries[] =
{
    { "cflags", 'c', 0, G_OPTION_ARG_NONE, &cflags, "[" CFLAGS_STRING "]", NULL },
    { "config-dir", 'C', 0, G_OPTION_ARG_NONE, &config_dir, "[" CONFIG_DIR_STRING "]", NULL },
    { "cppflags", 'f', 0, G_OPTION_ARG_NONE, &cppflags, "[" CPPFLAGS_STRING "]", NULL },
    { "include-dir", 'i', 0, G_OPTION_ARG_NONE, &include_dir, "[" INCLUDE_STRING "]", NULL },
    { "ldflags", 'd', 0, G_OPTION_ARG_NONE, &ldflags, "[" LDFLAGS_STRING "]", NULL },
    { "lib-dir", 'L', 0, G_OPTION_ARG_NONE, &lib_dir, "[" LIB_DIR_STRING "]", NULL },
    { "libs", 'l', 0, G_OPTION_ARG_NONE, &libs, "[" LIBS_STRING "]", NULL },
#ifdef HAVE_POSTGRESQL
    { "include-dir-postgresql", 'o', 0, G_OPTION_ARG_NONE, &include_dir_postgresql, "[" INCLUDE_DIR_POSTGRESQL_STRING "]", NULL },
    { "libs-postgresql", 'p', 0, G_OPTION_ARG_NONE, &libs_postgresql, "[" LIBS_POSTGRESQL_STRING "]", NULL },
#endif
#ifdef HAVE_MYSQL
    { "include-dir-mysql", 'y', 0, G_OPTION_ARG_NONE, &include_dir_mysql, "[" INCLUDE_DIR_MYSQL_STRING "]", NULL },
    { "libs-mysql", 'm', 0, G_OPTION_ARG_NONE, &libs_mysql, "[" LIBS_MYSQL_STRING "]", NULL },
#endif
    { "prefix", 'P', 0, G_OPTION_ARG_NONE, &prefix, "[" PREFIX_STRING "]", NULL },
    { "state-dir", 's', 0, G_OPTION_ARG_NONE, &state_dir, "[" STATE_DIR_STRING "]", NULL },
    { NULL }
};



int main(int argc, char *argv[])
{
    GError *error = NULL;
    GOptionContext *option_context = NULL;
    
    option_context = g_option_context_new("- LIXA config utility");
    g_option_context_add_main_entries(option_context, entries, NULL);
    
    if (!g_option_context_parse(option_context, &argc, &argv, &error)) {
        fprintf(stderr, "option parsing failed: %s\n", error->message);
        exit(1);
    }

    g_option_context_free(option_context);
    
    if (cflags) {
        printf(OUTPUT_FORMAT, CFLAGS_STRING);
    }
    if (config_dir) {
        printf(OUTPUT_FORMAT, CONFIG_DIR_STRING);
    }
    if (cppflags) {
        printf(OUTPUT_FORMAT, CPPFLAGS_STRING);
    }
    if (include_dir) {
        printf(OUTPUT_FORMAT, INCLUDE_STRING);
    }
    if (ldflags) {
        printf(OUTPUT_FORMAT, LDFLAGS_STRING);
    }
    if (lib_dir) {
        printf(OUTPUT_FORMAT, LIB_DIR_STRING);
    }
    if (libs) {
        printf(OUTPUT_FORMAT, LIBS_STRING);
    }
#ifdef HAVE_POSTGRESQL
    if (include_dir_postgresql) {
        printf(OUTPUT_FORMAT, INCLUDE_DIR_POSTGRESQL_STRING);
    }
    if (libs_postgresql) {
        printf(OUTPUT_FORMAT, LIBS_POSTGRESQL_STRING);
    }
#endif
#ifdef HAVE_MYSQL
    if (include_dir_mysql) {
        printf(OUTPUT_FORMAT, INCLUDE_DIR_MYSQL_STRING);
    }
    if (libs_mysql) {
        printf(OUTPUT_FORMAT, LIBS_MYSQL_STRING);
    }
#endif
    if (prefix) {
        printf(OUTPUT_FORMAT, PREFIX_STRING);
    }
    if (state_dir) {
        printf(OUTPUT_FORMAT, STATE_DIR_STRING);
    }

    return 0;
}



