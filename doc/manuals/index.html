<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>LIXA</title><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /></head><body><div class="book" lang="en" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="id3372623"></a>LIXA</h1></div><div><h2 class="subtitle">
    A libre, free, open source implementation of the XA and the TX 
    specifications
  </h2></div><div><div class="author"><h3 class="author"><span class="firstname">Christian</span> <span class="surname">Ferrari</span></h3></div></div><div><p class="copyright">Copyright © 2011 Christian Ferrari</p></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#id3372938">Preface</a></span></dt><dt><span class="chapter"><a href="#id3373188">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#id3373195">Why should I use LIXA project?</a></span></dt><dt><span class="section"><a href="#id3373311">Transaction Manager and Transaction Monitor</a></span></dt><dt><span class="section"><a href="#id3373430">LIXA Architecture</a></span></dt><dt><span class="section"><a href="#id3373473">Project, Projuct, Product</a></span></dt><dt><span class="section"><a href="#id3373474">LIXA and X/OPEN CAE specifications</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Installation">2. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#id3373892">System requirements</a></span></dt><dd><dl><dt><span class="section"><a href="#id3373937">Pre-requisites</a></span></dt><dt><span class="section"><a href="#id3374090">Co-requisites</a></span></dt><dt><span class="section"><a href="#id3374180">Authorization</a></span></dt></dl></dd><dt><span class="section"><a href="#id3374253">Software download</a></span></dt><dt><span class="section"><a href="#id3374300">Configure, build and install</a></span></dt><dd><dl><dt><span class="section"><a href="#id3374401">Advanced configuration</a></span></dt><dt><span class="section"><a href="#Linking_third_party_resource_managers">Linking third party resource managers</a></span></dt><dt><span class="section"><a href="#id3374795">Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#id3374816">Checking</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Configuration">3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#id3375027">Architectural elements</a></span></dt><dd><dl><dt><span class="section"><a href="#id3375098">Deployment models</a></span></dt></dl></dd><dt><span class="section"><a href="#id3375322">Configuring LIXA components</a></span></dt><dd><dl><dt><span class="section"><a href="#id3375387">Configuring the server</a></span></dt><dt><span class="section"><a href="#id3375639">Configuring the client</a></span></dt></dl></dd><dt><span class="section"><a href="#id3376137">Environment variables</a></span></dt><dd><dl><dt><span class="section"><a href="#id3376152">LIXA_CONFIG_FILE</a></span></dt><dt><span class="section"><a href="#id3376190">LIXA_CRASH_COUNT</a></span></dt><dt><span class="section"><a href="#id3376212">LIXA_CRASH_POINT</a></span></dt><dt><span class="section"><a href="#id3376236">LIXA_JOB</a></span></dt><dt><span class="section"><a href="#id3376265">LIXA_PROFILE</a></span></dt><dt><span class="section"><a href="#id3376299">LIXA_TRACE_MASK</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#id3376360">4. Execution</a></span></dt><dd><dl><dt><span class="section"><a href="#id3376393">Starting the state server</a></span></dt><dd><dl><dt><span class="section"><a href="#Background_execution">Background (<span class="emphasis"><em>daemon</em></span>) execution</a></span></dt><dt><span class="section"><a href="#id3376588">Maintenance mode execution</a></span></dt><dt><span class="section"><a href="#id3376641">Dump execution</a></span></dt><dt><span class="section"><a href="#id3376738">Additional options</a></span></dt></dl></dd><dt><span class="section"><a href="#id3376396">Starting the test utility</a></span></dt><dt><span class="section"><a href="#id3376914">Starting the recovery utility</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Development">5. Development</a></span></dt><dd><dl><dt><span class="section"><a href="#id3377231">The first example</a></span></dt><dd><dl><dt><span class="section"><a href="#id3377294">Some details about the example</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example2_ora">An example with a “<span class="quote">real</span>” Resource Manager (Oracle DBMS)</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_Oracle_environment">Set-up Oracle environment</a></span></dt><dt><span class="section"><a href="#Development_start_LIXA_server">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3377870">Build the client program</a></span></dt><dt><span class="section"><a href="#id3377916">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3378002">Check the data table before execution</a></span></dt><dt><span class="section"><a href="#id3378027">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3378104">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3378210">Program execution (static registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example3_db2">An example with IBM DB2 DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_DB2_environment">Set-up DB2 environment</a></span></dt><dt><span class="section"><a href="#id3378662">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3378680">Build the client program</a></span></dt><dt><span class="section"><a href="#id3378743">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3378826">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3378891">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3379116">Program execution (static registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#id3378310">An example with two distinct Resource Manager: Oracle DBMS and
      IBM DB2 DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#id3379321">Build the client program</a></span></dt><dt><span class="section"><a href="#id3379394">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3379542">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3379643">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3379649">Program execution (mixed registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example5_pql">An example with PostgreSQL DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_PostgreSQL_environment">Set-up PostgreSQL environment</a></span></dt><dt><span class="section"><a href="#id3380730">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3380766">Build the client program</a></span></dt><dt><span class="section"><a href="#id3380862">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3380980">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3381045">Program execution</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#Recovery">6. Recovery</a></span></dt><dt><span class="chapter"><a href="#id3381307">7. In Depth</a></span></dt><dd><dl><dt><span class="section"><a href="#Tracing">Tracing</a></span></dt><dt><span class="section"><a href="#id3381332">Logging</a></span></dt><dt><span class="section"><a href="#id3381342">Automatic and manual recovery</a></span></dt><dt><span class="section"><a href="#Non_root_installation">Non root installation</a></span></dt><dt><span class="section"><a href="#Workload_balanced_environments">Workload balanced environments</a></span></dt></dl></dd><dt><span class="bibliography"><a href="#id3381381">Bibliography</a></span></dt></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>3.1. <a href="#config1">Typical LIXA topology</a></dt><dt>3.2. <a href="#config2">Easiest non trivial deployment model</a></dt><dt>3.3. <a href="#config3">Trivial deployment model</a></dt><dt>3.4. <a href="#config4">Fully distributed deployment model</a></dt><dt>3.5. <a href="#config5">Complex distributed deployment model</a></dt><dt>3.6. <a href="#config6">The LIXA components and the necessary configuration files</a></dt><dt>3.7. <a href="#config7">The structure of lixad_conf.xml</a></dt><dt>3.8. <a href="#config8">The structure of lixac_conf.xml</a></dt><dt>3.9. <a href="#config9">A "real" environment</a></dt><dt>5.1. <a href="#develop1">Deploy model of an example with two dummy resource managers</a></dt><dt>5.2. <a href="#develop2">Deploy model of an example with Oracle Database Server</a></dt><dt>5.3. <a href="#develop3">Deploy model of an example with IBM DB2 DBMS</a></dt><dt>5.4. <a href="#develop4">Deploy model of an example showing a distributed transaction with Oracle and IBM DB2</a></dt><dt>5.5. <a href="#develop5">Deploy model of an example with PostgreSQL DBMS</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>5.1. <a href="#id3379662"></a></dt><dt>5.2. <a href="#id3379679"></a></dt><dt>5.3. <a href="#id3379718"></a></dt><dt>5.4. <a href="#id3379753"></a></dt><dt>5.5. <a href="#id3379781"></a></dt><dt>5.6. <a href="#id3379906"></a></dt><dt>5.7. <a href="#id3379931"></a></dt><dt>5.8. <a href="#id3379944"></a></dt><dt>5.9. <a href="#id3379971"></a></dt><dt>5.10. <a href="#id3380005"></a></dt><dt>5.11. <a href="#id3380026"></a></dt><dt>5.12. <a href="#id3380032"></a></dt><dt>5.13. <a href="#id3380088"></a></dt><dt>5.14. <a href="#id3380111"></a></dt><dt>5.15. <a href="#id3380138"></a></dt><dt>5.16. <a href="#id3380213"></a></dt><dt>5.17. <a href="#id3380281"></a></dt><dt>5.18. <a href="#id3380325"></a></dt><dt>5.19. <a href="#id3380363"></a></dt><dt>5.20. <a href="#id3380386"></a></dt><dt>5.21. <a href="#id3380599"></a></dt><dt>5.22. <a href="#id3380670"></a></dt><dt>5.23. <a href="#id3380685"></a></dt><dt>5.24. <a href="#id3380738"></a></dt><dt>5.25. <a href="#id3380786"></a></dt><dt>5.26. <a href="#id3380814"></a></dt><dt>5.27. <a href="#id3380872"></a></dt><dt>5.28. <a href="#id3380895"></a></dt><dt>5.29. <a href="#id3380955"></a></dt><dt>5.30. <a href="#id3381067"></a></dt><dt>5.31. <a href="#id3381094"></a></dt><dt>5.32. <a href="#id3381122"></a></dt><dt>5.33. <a href="#id3381143"></a></dt><dt>5.34. <a href="#id3381164"></a></dt><dt>5.35. <a href="#id3381188"></a></dt><dt>5.36. <a href="#id3381209"></a></dt><dt>5.37. <a href="#id3381243"></a></dt><dt>5.38. <a href="#id3381272"></a></dt></dl></div><div class="list-of-equations"><p><b>List of Equations</b></p><dl><dt>3.1. <a href="#id3375605">Suggested range for the number of managers</a></dt></dl></div><div class="preface" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id3372938"></a>Preface</h2></div></div></div><p>
    LIXA is acronym of LIbre XA: it's a free, libre, open source
    implementation of two X/Open specifications: "Distributed Transaction
    Processing: The TX (Transaction Demarcation) Specification" 
    [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>]
    and "Distributed Transaction Processing: The XA Specification"
    [<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>].
  </p><p>
    The main goals of the LIXA project are:
    </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>implementing an XA compliant Transaction Manager</p></li><li style="list-style-type: disc"><p>supplying a TX compliant Application Programming Interface
	  (<acronym class="acronym">API</acronym>)
	</p></li><li style="list-style-type: disc"><p><span class="emphasis"><em>to be free</em></span></p></li><li style="list-style-type: disc"><p>to be compliant as much as possible with X/Open CAE 
	  specifications</p></li></ul></div><p>
  </p><p>
    From the following links you can buy and/or download for free the official
    X/Open documentation:
    </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	  [<a class="citation" href="#id3381393"><span class="citation">RefModel</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/g504.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: Reference Model, Version 3
	    </em>
	  </a>
	</p></li><li style="list-style-type: disc"><p>
	  [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/c504.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The TX (Transaction 
	      Demarcation) Specification
	    </em>
	  </a>
	</p></li><li style="list-style-type: disc"><p>
	  [<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/c193.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The XA Specification
	    </em>
	  </a>
	</p></li><li style="list-style-type: disc"><p>
	  [<a class="citation" href="#id3381498"><span class="citation">XA+spec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/s423.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The XA+ Specification
	      Version 2
	    </em>
	  </a>
	</p></li></ul></div><p>
    LIXA documentation tries to avoid duplication with the content of the
    above books.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Intended audience</h3><p>
      This manual is maintained in the hope it can help:
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>developers who want to use LIXA project to develop applications
	  </p></li><li style="list-style-type: disc"><p>system administrators that have to install, configure and
	    manage LIXA project instances
	  </p></li><li style="list-style-type: disc"><p>curious people that want to discover the features offered by
	    the LIXA project
	  </p></li></ul></div><p>
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Language</h3><p>
      Unfortunately English is not my mother tongue. This manual may contain
      a lot of language mistakes. If you sent me a revisioned versions of the
      Docbook sources (XML), I would accept it promptly .
    </p></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id3373188"></a>Chapter 1. Introduction</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3373195">Why should I use LIXA project?</a></span></dt><dt><span class="section"><a href="#id3373311">Transaction Manager and Transaction Monitor</a></span></dt><dt><span class="section"><a href="#id3373430">LIXA Architecture</a></span></dt><dt><span class="section"><a href="#id3373473">Project, Projuct, Product</a></span></dt><dt><span class="section"><a href="#id3373474">LIXA and X/OPEN CAE specifications</a></span></dt></dl></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373195"></a>Why should I use LIXA project?</h2></div></div></div><p>
      LIXA project allows you to develop an Application Program that performs
      two phase commit transactions against two ore more Resource Managers.
      Two phase commit is a transactional protocol designed to 
      “<span class="quote">guarantee</span>” <acronym class="acronym">ACID</acronym> (Atomicity, Consistency,
      Isolation, Durability) transactionality.
      XA specification is not the only two phase commit protocol implementation
      but it is probably the best known and widespread. For detailed
      explanation please refer to [<a class="citation" href="#id3381393"><span class="citation">RefModel</span></a>].
    </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
      The reference model ([<a class="citation" href="#id3381393"><span class="citation">RefModel</span></a>]) technical guide
      available on the <span class="trademark">Open Group</span>™ web site is more
      recent than the XA specification ([<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>]); 
      after XA, the X/Open Company developed the XA+ specification and the 
      reference model was improved with the concepts necessary for XA+. 
      LIXA project does <span class="emphasis"><em>not</em></span> implement
      the XA+ specification, but only XA and the following concepts explained 
      in [<a class="citation" href="#id3381393"><span class="citation">RefModel</span></a>] does not apply to the LIXA project:
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>3.1: Superior Node</p></li><li style="list-style-type: disc"><p>3.1: Subordinate Node</p></li><li style="list-style-type: disc"><p>3.1: Communication Resource Manager (<acronym class="acronym">CRM</acronym>)</p></li><li style="list-style-type: disc"><p>3.5: Distributed Communication Facilities</p></li><li style="list-style-type: disc"><p>3.6: Activity between Functional Components Involving Two or More APs</p></li><li style="list-style-type: disc"><p>3.7: CRM Communication Paradigms with APs</p></li><li style="list-style-type: disc"><p>3.8: High-level TP Language</p></li></ul></div><p>
      XA specification was designed to implement the two phase commit protocol
      in the case there is only one Application Program running inside a
      Transaction Monitor and using a Transaction Manager to coordinate any
      number of Resource Managers. XA+ specification was designed to
      implement the two phase commit protocol in the case there are two or
      more Application Programs running inside distinct Transaction Monitors
      and using distinct Transaction Managers to coordinate any number of
      Resource Managers.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373311"></a>Transaction Manager and Transaction Monitor</h2></div></div></div><p>
      As explained in Appendix A of [<a class="citation" href="#id3381393"><span class="citation">RefModel</span></a>] a 
      Transaction Manager can be though as a subset of a Transaction Monitor.
      Most commercial products tend to merge the features
      in a single bundle; this is good if you need a Transaction Monitor,
      this may be bad if you only need a Transaction Manager.
    </p><p>
      IBM TXSeries<sup>[<a id="id3373335" href="#ftn.id3373335" class="footnote">1</a>]</sup> is a Transaction Monitor with an
      integrated Transaction Manager.
      Oracle (BEA) Tuxedo<sup>[<a id="id3373334" href="#ftn.id3373334" class="footnote">2</a>]</sup> is a Transaction Monitor with an
      integrated Transaction Manager.
      JBOSS<sup>[<a id="id3373336" href="#ftn.id3373336" class="footnote">3</a>]</sup> is a <acronym class="acronym">JEE</acronym>
      (Java Enterprise Edition) application server; it is a Transaction
      Monitor with an integrated Transaction Manager for bytecode based
      applications.
    </p><p>
      <a class="ulink" href="http://www.springsource.com/" target="_top">
	<em class="citetitle">Spring JTA Transaction Manager</em>
      </a>,
      <a class="ulink" href="http://jotm.objectweb.org/index.html" target="_top">
	<em class="citetitle">JOTM (Java Open Transaction Manager)</em>
      </a>
      and
      <a class="ulink" href="http://www.bitronix.be/" target="_top">
	<em class="citetitle">BTM (Bitronix JTA Transaction Manager)</em>
      </a> 
      are Transaction Managers, but they are not Transaction Monitors and they
      can be used in conjunction with a
      <acronym class="acronym">JVM</acronym> (Java Virtual Machine) and 
      <span class="emphasis"><em>possibly</em></span> any
      Transaction Monitor. Unfortunately they are Java based technologies and 
      not native ones; in the Java arena there are a few stand-alone 
      Transaction
      Manager, while in the C language arena it is not easy to find out one.
    </p><p>
      LIXA project implements a stand-alone Transaction Manager that your 
      Application Program can use in many different ways:
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>from a C application launched from shell</p></li><li style="list-style-type: disc"><p>from a C application launched via CGI from a web server</p></li><li style="list-style-type: disc"><p>from a scripting language application<sup>[<a id="id3373439" href="#ftn.id3373439" class="footnote">4</a>]</sup>.</p></li></ul></div><p>
      With the aid of the LIXA Transaction Manager potentially any web server 
      can be converted in an Application Server with two phase commit support.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373430"></a>LIXA Architecture</h2></div></div></div><p>
      From an architectural point of view, the LIXA project adopts an original
      approach: an Application Program links the LIXA client library and
      embeds the Transaction Manager logic. Every Application Program instance
      runs its own Transaction Manager instance and every Transaction
      Manager instance uses the LIXA server daemon to save and retrieve the
      state of the managed transactions.
      LIXA project was designed to allow massive parallelism and embedding at
      the same time: the parallelism is necessary to support high volume
      workloads while the embeddable property is necessary to avoid conflicts
      with the process and thread management feature of any Transaction 
      Monitors.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373473"></a>Project, Projuct, Product</h2></div></div></div><p>
      LIXA is a <span class="emphasis"><em>project</em></span>: a software artifact you can pick
      up to try, use, modify and distribute according to GPL license terms. 
      The project is hosted on 
      <a class="ulink" href="http://sourceforge.net/projects/lixa/" target="_top">
	<em class="citetitle">SourceForge</em>
      </a>
      collaborative portal and you can use the portal
      to interact with the author and other users.
      LIXA is not supported because it is not a product: you can use it AS IS
      without any guarantee.
    </p><p>
      A projuct is a software artifact that initially was a project financed 
      by a
      customer. A second customer was interested in the same software
      artifact, it was selled again. When the third customer knocked the door,
      the team that developed the project started a new business with a new
      <span class="emphasis"><em>product</em></span>. But it should be called 
      <span class="emphasis"><em>projuct</em></span> 
      because it was designed and modeled on the needs of the first customer.
    </p><p>
      In my honest opinion a <span class="emphasis"><em>product</em></span> is a software 
      artifact with some characteristics:
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>it is produced by a software factory</p></li><li style="list-style-type: disc"><p>it is sold by a commercial network</p></li><li style="list-style-type: disc"><p>it does have a team of specialists you can 
	    contact to have support</p></li><li style="list-style-type: disc"><p>it does have a team of specialists that can visit and 
	    help you with installation, configuration, problem determination, 
	    etc...</p></li><li style="list-style-type: disc"><p>it is fully documented</p></li><li style="list-style-type: disc"><p>it is certified to run properly on some documented 
	    hardware and software platforms</p></li><li style="list-style-type: disc"><p>it has a certified compatibility matrix the customer
	    can use to find out a valid mix of distinct software components
	    (i.e. different Resource Managers, for an XA Transaction 
	    Manager)</p></li><li style="list-style-type: disc"><p>it can be installed, updated and removed from a system
	    using the standard tool of the platform (i.e. dpkg, rpm, pkg,
	    etc....)</p></li><li style="list-style-type: disc"><p>it can be upgraded to a successive version without
	    side effects for the product and/or the hosting system
	</p></li></ul></div><p>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>LIXA project is not a product.</p></div><p>
    </p><p>
      If you were running a business that is interested in developing a 
      product based 
      on the technology implemented by the LIXA project you should
      contact the author through       
      <a class="ulink" href="http://sourceforge.net/projects/lixa/" target="_top">
	<em class="citetitle">SourceForge</em>
      </a>
      collaborative portal.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373474"></a>LIXA and X/OPEN CAE specifications</h2></div></div></div><p>
      The LIXA project tries to be as compliant as possible with the X/Open CAE
      specifications cited in bibliography. Below there are the not implemented
      and/or not implementable features.
    </p><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3373631"></a>The commit_return Characteristic</h3></div></div></div><p>
	As explained in [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>] (3.4, 3.8.1) two values
	are available:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="constant">TX_COMMIT_COMPLETED
	    </code></p></li><li style="list-style-type: disc"><p><code class="constant">TX_COMMIT_DECISION_LOGGED
	    </code></p></li></ul></div><p>
	LIXA TX API implementation supports only
	<code class="constant">TX_COMMIT_COMPLETED</code>
	this behavior is allowed by the specification.
      </p></div><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3373675"></a>The transaction state element</h3></div></div></div><p>
	As explained in [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>] (4.2, page 16)
	<code class="function">tx_info()</code> can return three values:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="constant">TX_ACTIVE
	    </code></p></li><li style="list-style-type: disc"><p><code class="constant">TX_TIMEOUT_ROLLBACK_ONLY
	    </code></p></li><li style="list-style-type: disc"><p><code class="constant">TX_ROLLBACK_ONLY
	    </code></p></li></ul></div><p>
      </p>
      LIXA <code class="function">tx_info()</code> does not return
      <code class="constant">TX_ROLLBACK_ONLY</code>. This does not hurt the
      X/Open CAE specification.
    </div><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3373726"></a>XA -&gt; TX return code mappings</h3></div></div></div><p>
	In [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>] (Appendix B.4, page 64) it is suggested
	to return the value <code class="constant">TX_ERROR</code> when the Resource
	Manager returns <code class="constant">XA_RETRY</code>; this is explained in
	“<span class="quote">note 1</span>”. 
      </p><p>
	The LIXA implementation of 
	For <code class="function">tx_commit()</code> and
	<code class="function">tx_rollback()</code> returns 
	<code class="constant">TX_NO_BEGIN</code> instead of 
	<code class="constant">TX_ERROR</code> because it seems a more useful 
	information for the Application Program: the transaction has been
	successfully committed/rolled back, but a new transaction can not be
	started
	<sup>[<a id="id3373775" href="#ftn.id3373775" class="footnote">5</a>]</sup>.
      </p></div><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3373791"></a><code class="function">xa_rollback()</code> and 
	<code class="constant">XA_RETRY</code> return code</h3></div></div></div><p>
	In [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>] (Appendix B.5, page 69) it is 
	explained <code class="constant">XA_RETRY</code> is a valid return code for
	function <code class="function">xa_rollback()</code>. Unfortunately
	[<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>] does not agree with this point of view: the
	<code class="constant">XA_RETRY</code> is not a valid return code for 
	function <code class="function">xa_rollback()</code>. It may be an error in
	[<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>]: the same row could be copied from the 
	previous table (page 68).
      </p><p>
	[<a class="citation" href="#id3381498"><span class="citation">XA+spec</span></a>] does not list 
	<code class="constant">XA_RETRY</code> as a valid return code for 
	function <code class="function">xa_rollback()</code>; it lists
	<code class="constant">XA_RETRY_COMMFAIL</code> but it does not apply to LIXA
	implementation because it is related to the 
	<span class="emphasis"><em>Communication Resource Manager</em></span> concept that is
	not supported by LIXA implementation.
      </p><p>
	The LIXA implementation sticks to [<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>]: if a
	resource manager returned <code class="constant">XA_RETRY</code> it would be
	considered a bug inside the resource manager.
      </p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id3373335" href="#id3373335" class="para">1</a>] </sup>TXSeries is a registered trademark of 
	  IBM corporation</p></div><div class="footnote"><p><sup>[<a id="ftn.id3373334" href="#id3373334" class="para">2</a>] </sup>Tuxedo is a registered trademark of
	  Oracle corporation</p></div><div class="footnote"><p><sup>[<a id="ftn.id3373336" href="#id3373336" class="para">3</a>] </sup>JBOSS is a registered trademark of Red Hat
	  corporation</p></div><div class="footnote"><p><sup>[<a id="ftn.id3373439" href="#id3373439" class="para">4</a>] </sup>You must wrap the TX C API to be able to use it from Perl, PHP, Python, Ruby...</p></div><div class="footnote"><p><sup>[<a id="ftn.id3373775" href="#id3373775" class="para">5</a>] </sup>The X/Open CAE specification document
	    “<span class="quote">suggests</span>” the mapping and it seems there is some
	    flesibility in the suggestions. From a LIXA perspective all this
	    stuff is academic because <code class="constant">TMNOWAIT</code> is not
	    used by LIXA implementation.</p></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="Installation"></a>Chapter 2. Installation</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3373892">System requirements</a></span></dt><dd><dl><dt><span class="section"><a href="#id3373937">Pre-requisites</a></span></dt><dt><span class="section"><a href="#id3374090">Co-requisites</a></span></dt><dt><span class="section"><a href="#id3374180">Authorization</a></span></dt></dl></dd><dt><span class="section"><a href="#id3374253">Software download</a></span></dt><dt><span class="section"><a href="#id3374300">Configure, build and install</a></span></dt><dd><dl><dt><span class="section"><a href="#id3374401">Advanced configuration</a></span></dt><dt><span class="section"><a href="#Linking_third_party_resource_managers">Linking third party resource managers</a></span></dt><dt><span class="section"><a href="#id3374795">Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#id3374816">Checking</a></span></dt></dl></div><p>
    This chapter explains how to download, install and verify the software
    released by LIXA project.
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3373892"></a>System requirements</h2></div></div></div><p>
      LIXA project is developed on an x86 based 
      <a class="ulink" href="http://www.ubuntu.com/" target="_top">
	<em class="citetitle">Ubuntu 8.04 system</em>
      </a>; it
      compiles and runs on both <span class="emphasis"><em>server</em></span> and
      <span class="emphasis"><em>desktop</em></span> flavors. Installation on a different 
      GNU/Linux
      distribution should be quite straightforward; installation on a different
      <span class="trademark">UNIX</span>™ like system would probably need some work.
    </p><p>
      If you successfully installed LIXA on a different system, you might
      publish your experience on the public forum hosted on SourceForge.net 
      and share your results with other users. 
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3373937"></a>Pre-requisites</h3></div></div></div><p>
	To compile LIXA software the GNU tools are needed: gcc, gmake, libtool.
	Autoconf and automake are used, but should not be necessary if you want
	to install the original tarball.
      </p><p>
	Some <span class="emphasis"><em>libraries (run time and development stuff)</em></span> 
	are necessary too:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="application">libdl</span></p></li><li style="list-style-type: disc"><p><span class="application">libglib</span></p></li><li style="list-style-type: disc"><p><span class="application">libgmodule</span></p></li><li style="list-style-type: disc"><p><span class="application">libgthread</span></p></li><li style="list-style-type: disc"><p><span class="application">libm</span></p></li><li style="list-style-type: disc"><p><span class="application">libpthread</span></p></li><li style="list-style-type: disc"><p><span class="application">libuuid</span></p></li><li style="list-style-type: disc"><p><span class="application">libxml2</span></p></li></ul></div><p>
	<span class="application">libglib</span> (and others libg*) and 
	<span class="application">libxml2</span> are discovered with 
	<span class="command"><strong>pkg-config</strong></span> command, while the others must be in
	standard include <code class="envar">PATH</code>.
      </p><div class="simplesect" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374028"></a>Low level pre-requisites</h4></div></div></div><p>
	  If you are trying to install LIXA software on a different operating
	  system, these are some fundamental requirements:
	  </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><code class="function">poll</code>: 
		LIXA daemon uses this function for high parallelism network
		operations
	    </p></li><li style="list-style-type: disc"><p><code class="function">mmap</code>:
		LIXA daemon uses this function for high performance disk
		access
	    </p></li><li style="list-style-type: disc"><p><code class="function">dlopen</code>:
		LIXA transaction manager uses this function to dynamically load
		resource managers XA switch structures 
	    </p></li><li style="list-style-type: disc"><p><code class="function">uuid_generate</code>:
		LIXA transaction manager uses this function to generate unique
		transaction identifiers (xid)
	    </p></li></ul></div><p>
	  Without the above functions, a specific porting process is necessary
	  to adapt LIXA to your system.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3374090"></a>Co-requisites</h3></div></div></div><p>
	An XA transaction manager is used to coordinate one or more XA
	resource managers. From a LIXA perspective there are basically 3 type
	of resource managers:
	</p><div class="orderedlist"><ol type="1"><li><p>
	      <span class="emphasis"><em>LIXA:</em></span> resource managers
	      provided by the project for testing and as sample implementations
	  </p></li><li><p>
	      <span class="emphasis"><em>F/OSS:</em></span> resource managers provided by
	      Free/Open Source Software projects; at the time of this
	      writing this set is empty, but it could be different
	      in the near future
	      <sup>[<a id="id3374126" href="#ftn.id3374126" class="footnote">6</a>]</sup>
	  </p></li><li><p>
	      <span class="emphasis"><em>Proprietary:</em></span> resource managers
	      provided by business corporations using commercial licensing.
	  </p></li></ol></div><p>
	There is not a list of <span class="emphasis"><em>supported</em></span> third party
	resource managers, because LIXA is a project and not a product; this
	is the list of third party resource managers that have been tested in
	conjuction with LIXA transaction manager:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p><span class="productname">
		IBM DB2 Express-C 9.7
	  </span></p></li><li style="list-style-type: disc"><p><span class="productname">
		Oracle XE 10.2
	  </span></p></li></ul></div><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3374180"></a>Authorization</h3></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The software produced by the LIXA project 
	<span class="emphasis"><em>does</em></span> not require any
	special authorization to run.
      </p></div><p>
	You can run the processes with the desired UNIX user you prefer but
	in this manual specific user and group will be used as a suggestion.
	Use this commands in an Ubuntu based Linux system to create the
	<code class="systemitem">lixa</code> user and the
	<code class="systemitem">lixa</code> group:
	</p><pre class="screen">
tiian@ubuntu:~$ sudo su -
root@ubuntu:~# id
uid=0(root) gid=0(root) groups=0(root)
root@ubuntu:~# addgroup --system lixa
Adding group `lixa' (GID 113) ...
Done.
root@ubuntu:~# adduser --system --ingroup lixa --shell /bin/bash lixa
Adding system user `lixa' (UID 106) ...
Adding new user `lixa' (UID 106) with group `lixa' ...
Creating home directory `/home/lixa' ...
root@ubuntu:~# su -c id lixa
uid=106(lixa) gid=113(lixa) groups=113(lixa)
root@ubuntu:~# exit
logout
	</pre><p>
	Refer to the man page of your Linux distribution if the above
	commands fail; on some distributions you must use
	“<span class="quote"><span class="command"><strong>su -</strong></span></span>” instead of 
	“<span class="quote"><span class="command"><strong>sudo su -</strong></span></span>”.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  LIXA client communicates to LIXA server (daemon) throught TCP/IP and
	  the client processes do not access the status files located in
	  <code class="filename">/opt/lixa/var/</code>, only the 
	  <span class="command"><strong>lixad</strong></span> has to access the status files.
      </p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3374253"></a>Software download</h2></div></div></div><p>
      The LIXA project is hosted on SourceForge.net portal at this URL:
      <a class="ulink" href="http://sourceforge.net/projects/lixa/" target="_top">
	<em class="citetitle">http://sourceforge.net/projects/lixa/</em>
      </a>
    </p><p>
      The software is available only as a <span class="emphasis"><em>source code</em></span>
      tarball; no
      pre-compiled packages are available: you need the C development tools
      installed to have success in LIXA installation. It is suggested to 
      download the gzipped tarball from the main page: the latest available
      release is generally what you need; you could download a previous release
      if you had a reason to do it.
    </p><p>
      Alternatively you can fetch the source code using a subversion client,
      but you should pay attention that many commits on the subversion 
      repository
      are intermediate works and can give you partial or broken/under
      construction features.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3374300"></a>Configure, build and install</h2></div></div></div><p>
      LIXA project tries to adhere to the GNU <span class="emphasis"><em>de facto</em></span>
      standard. Supposing you downloaded the package 
      <code class="filename">lixa-X.Y.Z.tar.gz</code>, the basic sequence is:
      </p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure
make
      </pre><p>
      To install the software you need root access. With some distributions, 
      like Ubuntu, root access is available with the 
      <span class="command"><strong>sudo</strong></span> command and your own password:
      </p><pre class="screen">
sudo make install
      </pre><p>
      If the previous command does not work, root access is available with the
      <span class="command"><strong>su</strong></span> command and the root password: 
      </p><pre class="screen">
su; make install; exit
      </pre><p>
      If nothing goes wrong, the above commands install the LIXA software
      artifacts in <code class="filename">/opt/lixa</code> default directory.
      After the installation you should change the authorization
      assigned to some directories. Use <span class="command"><strong>sudo su -c</strong></span> or
      <span class="command"><strong>su -c</strong></span> to gain root privileges and then:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su -c "chown -R lixa:lixa /opt/lixa/etc/ /opt/lixa/var/"
tiian@ubuntu:~$ ls -la /opt/lixa/etc/ /opt/lixa/var/
/opt/lixa/etc/:
total 16
drwxr-xr-x 2 lixa lixa 4096 2011-03-30 23:13 .
drwxr-xr-x 9 lixa root 4096 2011-03-30 23:14 ..
-rw-r--r-- 1 lixa lixa 3542 2011-03-30 23:13 lixac_conf.xml
-rw-r--r-- 1 lixa lixa  447 2011-03-30 23:13 lixad_conf.xml

/opt/lixa/var/:
total 12
drwxr-xr-x 2 lixa lixa 4096 2011-03-30 23:14 .
drwxr-xr-x 9 lixa root 4096 2011-03-30 23:14 ..
-rw-r--r-- 1 lixa lixa  178 2011-03-30 23:14 README
      </pre><p>
      The succesful execution of the above commands guarantees the
      configuration and the state files can be managed using the
      LIXA administrative account (
      user=<code class="systemitem">lixa</code>,
      group=<code class="systemitem">lixa</code>).
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  The <span class="command"><strong>chown</strong></span> command must be executed after every
	  <span class="command"><strong>make install</strong></span> execution.
      </p></div><p>
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3374401"></a>Advanced configuration</h3></div></div></div><p>
	There are many options you can pass to <span class="command"><strong>configure</strong></span>
	command to meet your needs (see below). Skip this section and
	jump directly to
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>
	if you are not expert in LIXA configuration to avoid troubles.
      </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374432"></a>Choosing a different installation <code class="envar">PATH</code></h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The commands explained in the previous section should be
	    adapted to different paths, if you choosed a non standard
	    installation path.
	</p></div><p>
	  Performing the very first install <code class="filename">/tmp</code> 
	  could be a good destination:
	  </p><pre class="screen">
./configure --prefix=/tmp/lixa
	  </pre><p>
	</p><p>
	  After some testing, you might prefer your home directory:
	  </p><pre class="screen">
./configure --prefix=$HOME/lixa
	  </pre><p>
	  and you will get a layout like this:
	  </p><pre class="screen">
$HOME/lixa/bin
$HOME/lixa/etc
$HOME/lixa/include
$HOME/lixa/lib
$HOME/lixa/sbin
$HOME/lixa/var
	  </pre><p>
	</p><p>
	  You can split code and data with something like this:
	  </p><pre class="screen">
./configure --prefix=/ --exec-prefix=/usr/local
	  </pre><p>
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374478"></a>Locating pre-requisites libraries</h4></div></div></div><p>
	  If any of the pre-requisite library include files are not in the
	  standard search <code class="envar">PATH</code>, you can export 
	  <code class="envar">CPPFLAGS</code> before the configure process to add 
	  your custom path:
	  </p><pre class="screen">
export CPPFLAGS=-I/path/to/libuuid
./configure
make
	  </pre><p>
	  to see the list of environment variables that can affect the build 
	  process
	  use the command
	  </p><pre class="screen">
./configure --help
	  </pre><p>
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374511"></a>Optional features</h4></div></div></div><p>
	  The supplied defaults are generally good enought to start 
	  working with LIXA, but if you want to perform some hacking 
	  you might be interested
	  in activating/deactivating some optional features.
	</p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="id3374526"></a>Tracing</h5></div></div></div><p>
	    The tracing feature is enabled by default: the binary objects
	    produced by the build procedure contains a lot of messages that can
	    be displayed turning on tracing at run time.
	  </p><p>
	    Removing the tracing feature can save RAM (smaller binary objects)
	    and CPU (every trace message is tested against run time 
	    configuration).
	  </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      Disabling tracing seems a good way to increase the performance of
	      the software, but unfortunately without a trace it is quite 
	      impossible to debug some issues. Only rock stable software can
	      be compiled without tracing, and this is not the case of LIXA.
	    </p></div><p>
	    To disable tracing, use <code class="option">--disable-trace</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --disable-trace
	    </pre><p>
	  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="id3374575"></a>Extra debug code</h5></div></div></div><p>
	    To enable extra debug code, that's basically some redundant check
	    code use <code class="option">--enable-debug</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --enable-debug
	    </pre><p>
	    This feature could be interesting when porting the LIXA project
	    software to a different platform; for normal use, the extra
	    debugging code is useless.
	  </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h5 class="title"><a id="id3374602"></a>Crash simulation</h5></div></div></div><p>
	    This feature is useful when testing the software: with crash
	    simulation the software can be tested against simulated software
	    crashes and, on some extents, power outages.
	    To enable crash simulation use <code class="option">--enable-crash</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --enable-crash
	    </pre><p>
	  </p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Linking_third_party_resource_managers"></a>Linking third party resource managers</h3></div></div></div><p>
	To link an already tested third party resource manager you can use
	a specific option on <span class="command"><strong>./configure</strong></span> command; to
	link a new resource manager, you have to hack the Makefiles and
	put all you need in place or you can perform a manual link.
      </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374652"></a>IBM DB2 Express-C 9.7<sup>[<a id="id3374658" href="#ftn.id3374658" class="footnote">7</a>]</sup></h4></div></div></div><p>
	  This step is useful if you want to use IBM DB2 as a Resource
	  Manager coordinated by LIXA; only version Express-C 9.7 has been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this:
	  </p><pre class="screen">
./configure --with-ibmdb2=/opt/ibm/db2/V9.7
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374682"></a>Oracle XE 10.2<sup>[<a id="id3374687" href="#ftn.id3374687" class="footnote">8</a>]</sup></h4></div></div></div><p>
	  This step is useful if you want to use Oracle Database as a Resource
	  Manager coordinated by LIXA; only version XE 10.2 has been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this:
	  </p><pre class="screen">
./configure --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p><p>
	  Extra configuration is needed in order to use Oracle DBMS; the
	  necessary steps are documented in the configuration chapter.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374716"></a>PostgreSQL 8.3<sup>[<a id="id3374721" href="#ftn.id3374721" class="footnote">9</a>]</sup></h4></div></div></div><p>
	  This step is useful if you want to use PostgreSQL as a Resource
	  Manager coordinated by LIXA; only version 8.3.15 has been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this:
	  </p><pre class="screen">
./configure --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    PostgreSQL does not supply an XA standard switch structure, but
	    only some SQL non standard statements (
	    <code class="code">PREPARE TRANSACTION, COMMIT PREPARED, ROLLBACK PREPARED</code>
	    ) that can be used to implement some XA features.
	    This is good enought to build a loadable module that can be
	    used by the LIXA transaction manager, but some XA standard features
	    - like dynamic registration - can not be implemented.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3374768"></a>Two or more resource managers</h4></div></div></div><p>
	  If you want to use two or more resource managers, and this is a
	  typical condition for the XA usage, you must concatenate two or more
	  <em class="parameter"><code>--with-</code></em> parameters.
	  This command, for instance, can be used to build IBM DB2, Oracle
	  and PostgreSQL loadable modules:
	  </p><pre class="screen">
./configure --with-ibmdb2=/opt/ibm/db2/V9.7 --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib
	  </pre><p>
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3374795"></a>Summary</h3></div></div></div><p>
	The options illustrated above can be combined to obtain a specific
	configuration. This is an example of a IBM DB2 + Oracle enabled
	installation using an alternate installation path:
	</p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure --prefix=$HOME/lixa --with-ibmdb2=/opt/ibm/db2/V9.7 --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
make
sudo make install
	</pre><p>
      </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3374816"></a>Checking</h2></div></div></div><p>
      Before using LIXA to manage your transactions you might be interested
      in checking the compiled software quality.
    </p><p>
      LIXA has its own test suite implemented with 
      <span class="application">Autotest</span>. A specific build configuration is
      <span class="emphasis"><em>necessary</em></span> to enable all the tests:
      </p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure --prefix=/tmp/lixa --enable-crash
make check
      </pre><p>
      If the binary code produced by the compiler is fine, and your system
      is fine too, all the test <span class="emphasis"><em>must</em></span> complete without
      errors.
    </p></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id3374126" href="#id3374126" class="para">6</a>] </sup>
		  I think the lack of the XA interface in the implementation 
		  of 
		  the F/OSS resource managers is a consequence of the lack of
		  a F/OSS transaction manager; looking at the Java ecosystem,
		  both MySQL and PostgreSQL supports JTA, that's basically
		  “<span class="quote">a Java XA wrapper</span>”, because there are JTA
		  compliant application server like Jboss, JOnAS and Jeronimo.
	      </p></div><div class="footnote"><p><sup>[<a id="ftn.id3374658" href="#id3374658" class="para">7</a>] </sup>
	      IBM and DB2 are trademark of <span class="trademark">IBM</span>™
	      corporation
	</p></div><div class="footnote"><p><sup>[<a id="ftn.id3374687" href="#id3374687" class="para">8</a>] </sup>
	      Oracle is a trademark of <span class="trademark">Oracle</span>™
	      corporation
	</p></div><div class="footnote"><p><sup>[<a id="ftn.id3374721" href="#id3374721" class="para">9</a>] </sup>
	      The Trademark Policy of PostgreSQL is available at this link:
	      <a class="ulink" href="http://wiki.postgresql.org/wiki/Trademark_Policy" target="_top">
		http://wiki.postgresql.org/wiki/Trademark_Policy</a>
	</p></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="Configuration"></a>Chapter 3. Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3375027">Architectural elements</a></span></dt><dd><dl><dt><span class="section"><a href="#id3375098">Deployment models</a></span></dt></dl></dd><dt><span class="section"><a href="#id3375322">Configuring LIXA components</a></span></dt><dd><dl><dt><span class="section"><a href="#id3375387">Configuring the server</a></span></dt><dt><span class="section"><a href="#id3375639">Configuring the client</a></span></dt></dl></dd><dt><span class="section"><a href="#id3376137">Environment variables</a></span></dt><dd><dl><dt><span class="section"><a href="#id3376152">LIXA_CONFIG_FILE</a></span></dt><dt><span class="section"><a href="#id3376190">LIXA_CRASH_COUNT</a></span></dt><dt><span class="section"><a href="#id3376212">LIXA_CRASH_POINT</a></span></dt><dt><span class="section"><a href="#id3376236">LIXA_JOB</a></span></dt><dt><span class="section"><a href="#id3376265">LIXA_PROFILE</a></span></dt><dt><span class="section"><a href="#id3376299">LIXA_TRACE_MASK</a></span></dt></dl></dd></dl></div><p>
    A LIXA system is the assembling of two components: the client and 
    the server. The figure
    below shows a typical configuration with one Application
    Program and two Resource Managers.
  </p><div class="figure"><a id="config1"></a><p class="title"><b>Figure 3.1. Typical LIXA topology</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_1.png" alt="Typical LIXA topology" /></div></div></div><br class="figure-break" /><p>
    The model shows logical and "phisycal" blocks:
    </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	  "Application Program code" is the code of your own application
      </p></li><li style="list-style-type: disc"><p>
	  "librm1" is the code of the library your application must use to
	  communicate with "RM1" (the first resource manager)
      </p></li><li style="list-style-type: disc"><p>
	  "librm2" is the code of the library your application must use to
	  communicate with "RM2" (the second resource manager)
      </p></li><li style="list-style-type: disc"><p>
	  "liblixac" is the code of the library your application must use to
	  invoke the TX verbs and send instruction to the Transaction Manager
      </p></li><li style="list-style-type: disc"><p>
	  "Application Program code" + "librm1" + "librm2" + "liblixac" must
	  be linked togheter to produce the Application Program; the
	  Application Program is an executable object
      </p></li><li style="list-style-type: disc"><p>
	  "RM1" is the first resource manager; it may be a relational database
	  (RDBMS)
      </p></li><li style="list-style-type: disc"><p>
	  "RM2" is the second resource manager; it may be an object oriented
	  database (OODBMS)
      </p></li><li style="list-style-type: disc"><p>
	  "lixad" is the <span class="emphasis"><em>daemon</em></span> used by "liblixac" to
	  store the states of the transactions
      </p></li></ul></div><p>
  </p><p>
    The model shows how the blocks communicate:
    </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	  (A1): is the protocol supplied by the first resource manager; 
	  SQL/CLI is an example and is supplied by IBM DB2, 
	  SQL/OCI is another example and is supplied by Oracle Database Server
      </p></li><li style="list-style-type: disc"><p>
	  (B1): is the protocol supplied by the second resource manager; every
	  resource manager has its own protocol and its own API
      </p></li><li style="list-style-type: disc"><p>
	  (A2): is the internal protocol used by the client of RM1 to 
	  communicate with RM1 server process(es); it can be a cross memory
	  or a network protocol and it depends on RM1 configuration
      </p></li><li style="list-style-type: disc"><p>
	  (B2): is the internal protocol used by the client of RM2 to 
	  communicate with RM2 server process(es); it can be a cross memory
	  or a network protocol and it depends on RM2 configuration
      </p></li><li style="list-style-type: disc"><p>
	  (TX): is the protocol supplied by the LIXA project and is described
	  in [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>]; it's a standard protocol and API
      </p></li><li style="list-style-type: disc"><p>
	  (XA): is the standard protocol used by the LIXA project to 
	  communicateand with the resource managers and is described
	  in [<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>]; it's a standard protocol and API
      </p></li><li style="list-style-type: disc"><p>
	  (LX): is the internal protocol used by the client of LIXA to 
	  communicate with the LIXA server process (lixad); it is a network 
	  protocol
      </p></li></ul></div><p>
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3375027"></a>Architectural elements</h2></div></div></div><p>
      The <span class="command"><strong>lixad</strong></span> daemon process can be executed on any
      system: there is no need it is executed on the same system that's hosting
      the Application Programs. The communications between 
      the client and the server (<span class="command"><strong>lixad</strong></span>) uses TCP/IP sockets.
    </p><p>
      The <span class="command"><strong>lixac</strong></span> library is embedded in the Application
      Programs; the communication between the Application Program and
      the <span class="command"><strong>lixac</strong></span> library uses TX (Transaction Demarcation)
      API, see [<a class="citation" href="#id3381428"><span class="citation">TXspec</span></a>]. The <span class="command"><strong>lixac</strong></span> 
      library contains all the logic of the LIXA Transaction Manager.
    </p><p>
      The communication between the Application Program and the Resource
      Managers depends on Resource Managers type and configuration: 
      it may be cross memory, TCP/IP, System V IPC, etc...
      The communication between the <span class="command"><strong>lixac</strong></span> library and the
      Resource Manager depends on Resource Manager configuration and must be
      of the same used by the Application Program.
    </p><p>
      The communication between <span class="command"><strong>lixac</strong></span> library and 
      <span class="command"><strong>lixad</strong></span> is ever istantiated by the client: the
      server never calls the clients.
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3375098"></a>Deployment models</h3></div></div></div><p>
	This section explains some different deployment models you can
	set up leveraging the LIXA project technology.
      </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3375112"></a>The easiest non trivial model</h4></div></div></div><p>
	  The easiest non trivial deployment of a distributed transaction
	  processing system based on the LIXA project is showed below: a single
	  node hosts the Application Program, the Resource Managers and the
	  LIXA server.
	</p><div class="figure"><a id="config2"></a><p class="title"><b>Figure 3.2. Easiest non trivial deployment model</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_2.png" alt="Easiest non trivial deployment model" /></div></div></div><br class="figure-break" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3375151"></a>A trivial model</h4></div></div></div><p>
	  A trivial deployment of a distributed transaction
	  processing system based on the LIXA project is showed below: a single
	  node hosts the Application Program, the Resource Manager and the
	  LIXA server. This configuration is obtained from the previous one
	  removing a Resource Manager.
	</p><p>
	  Using only one Resource Manager is supported by the LIXA project
	  technology, but it's quite useless because you don't need a
	  transaction manager to perform 
	  <span class="emphasis"><em>single phase commit</em></span> against 
	  <span class="emphasis"><em>one</em></span>
	  Resource Manager. This type of configuration will not be described
	  more deeply.
	</p><div class="figure"><a id="config3"></a><p class="title"><b>Figure 3.3. Trivial deployment model</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_3.png" alt="Trivial deployment model" /></div></div></div><br class="figure-break" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3375196"></a>A fully distributed model</h4></div></div></div><p>
	  A fully distributed transaction processing system can be achieved
	  hosting every component in a different node.
	  The picture below shows 4 different nodes:
	  </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
		an application server node hosting the Application Program
	    </p></li><li style="list-style-type: disc"><p>
		a Transaction Manager dedicated node hosting the 
		LIXA server
	    </p></li><li style="list-style-type: disc"><p>
		two Resource Manager dedicated nodes hosting the
		Reosurce Manager
	    </p></li></ul></div><p>
	</p><div class="figure"><a id="config4"></a><p class="title"><b>Figure 3.4. Fully distributed deployment model</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_4.png" alt="Fully distributed deployment model" /></div></div></div><br class="figure-break" /></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3375250"></a>A more complex distributed model</h4></div></div></div><p>
	  A more complex distributed transaction processing system 
	  can be achieved introducing a second application server and a third
	  Resource Manager; in the picture below the third Resource Manager 
	  is hosted in the same node of the second Resource Manager.
	</p><p>
	  The two different Application Programs do not need to be hosted in
	  different application servers. They are different 
	  Application Programs because they use a different mix of
	  Resource Managers.
	</p><div class="figure"><a id="config5"></a><p class="title"><b>Figure 3.5. Complex distributed deployment model</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_5.png" alt="Complex distributed deployment model" /></div></div></div><br class="figure-break" /><p>
	  Further complexity can be reached introducing an Application
	  Program that uses three (or more) different Resource Managers,
	  but this document will not go on this path to preserve
	  understandability
	  <sup>[<a id="id3375303" href="#ftn.id3375303" class="footnote">10</a>]</sup>
	  .
	</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3375322"></a>Configuring LIXA components</h2></div></div></div><p>
      The picture below emphasizes the LIXA components must be configured
      in a simple scenario:
    </p><div class="figure"><a id="config6"></a><p class="title"><b>Figure 3.6. The LIXA components and the necessary configuration files</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_6.png" alt="The LIXA components and the necessary configuration files" /></div></div></div><br class="figure-break" /><p>
      The client component (<span class="command"><strong>lixac</strong></span>) is configured using the
      <code class="filename">etc/lixac_conf.xml</code> file; the server component
      (<span class="command"><strong>lixad</strong></span>) is configured using the
      <code class="filename">etc/lixad_conf.xml</code> file
      <sup>[<a id="id3375378" href="#ftn.id3375378" class="footnote">11</a>]</sup>.
    </p><p>
      If a node hosts both the client and the server components, both the
      files must be configured. If a node hosts only one component, only
      one configuration file is necessary
      <sup>[<a id="id3375389" href="#ftn.id3375389" class="footnote">12</a>]</sup>.
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3375387"></a>Configuring the server</h3></div></div></div><p>
	The default configuration file is 
	<code class="filename">etc/lixad_conf.xml</code>
	and is located at the root installation path (i.e.
	<code class="filename">/opt/lixa/etc/lixad_conf.xml</code>).
      </p><p>
	The file is composed of three sections:
	</p><div class="figure"><a id="config7"></a><p class="title"><b>Figure 3.7. The structure of lixad_conf.xml</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_7.png" alt="The structure of lixad_conf.xml" /></div></div></div><p><br class="figure-break" />
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>server</em></span> section contains the global
	      parameters of the server
	  </p></li><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>listeners</em></span> section specifies how many
	      TCP/IP addresses and ports must be listened to accept incoming
	      client connections
	  </p></li><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>managers</em></span> section specifies how many
	      parallel threads must be activated to serve the LIXA clients
	  </p></li></ul></div><p>
      </p><p>
	Below there is a sample configuration file:
	</p><pre class="screen">
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;server pid_file="/opt/lixa/var/run.pid"&gt;
  &lt;listeners&gt;
    &lt;listener domain="AF_INET" address="127.0.0.1" port="3456"/&gt;
    &lt;listener domain="AF_INET" address="0.0.0.0" port="2345"/&gt;
  &lt;/listeners&gt;
  &lt;managers&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status1"/&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status2"/&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status3"/&gt;
  &lt;/managers&gt;
&lt;/server&gt;
      </pre><p>
	The tags and the
	properties of the XML file are described below:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      <code class="varname">pid_file</code>: it is the file used by the server 
	      to store the daemon <acronym class="acronym">PID</acronym>; the server creates
	      the file at start-up and destroys it at shutdown
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">listener</code>: the server can activate one or more
	      listeners; most of the times one listener is sufficient, but if
	      you want to use only a subset of the IP addresses defined at
	      the operating system level, you have to configure a dedicated
	      listener for every desired address
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">domain</code>: the type of socket must be used to
	      listen for clients. The only allowed type is 
	      <code class="constant">AF_INET</code>; this may change in the future
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">address</code>: the address that must be used 
	      to listen for
	      clients; the special value "<code class="constant">0.0.0.0</code>" means
	      <span class="emphasis"><em>any</em></span> address
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">port</code>: the port that must be used to listen for
	      clients; it must be a free port (use command 
	      <span class="command"><strong>netstat</strong></span> to find out one)
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">manager</code>: any configured 
	      <span class="emphasis"><em>manager</em></span> is a server worker and runs as
	      a dedicated thread. The number of managers that should 
	      be activated 
	      depends on the workload; if D is the number of indipendent 
	      hard disk devices and P is the number of processors/cores, the
	      suggested values are in the range:
	      </p><div class="equation"><a id="id3375605"></a><p class="title"><b>Equation 3.1. Suggested range for the number of managers</b></p><div class="equation-contents"><span class="mathphrase">
		  [min(D,P) ; D*P]
		</span></div></div><p><br class="equation-break" />
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">status_file</code>: the physical path that 
	      must be used to
	      create the status files (a couple) for a manager; 
	      this generally is
	      a persistent and reliable storage device like a RAID partition.
	      The string specified by the tag <code class="varname">status_file</code>
	      is used as a prefix: every manager (thread) creates two files
	      with the same prefix and different suffix.
	  </p></li></ul></div><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3375639"></a>Configuring the client</h3></div></div></div><p>
	The default configuration file is 
	<code class="filename">etc/lixac_conf.xml</code>
	and is located at the root installation path (i.e.
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>). 
      </p><p>
	The file is composed of three sections:
	</p><div class="figure"><a id="config8"></a><p class="title"><b>Figure 3.8. The structure of lixac_conf.xml</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_8.png" alt="The structure of lixac_conf.xml" /></div></div></div><p><br class="figure-break" />
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>state servers</em></span> section 
	      contains a list of the available LIXA state servers and how they
	      can be contacted
	  </p></li><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>resource managers</em></span> section
	      contains a list of the available Resource Managers and how they
	      can be managed by LIXA using XA standard API and protocol
	  </p></li><li style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>profiles</em></span> section
	      contains a set of possibly different profiles: every
	      Application Program can use only one profile; if you had
	      different Application Programs with different requirements,
	      you should create different profiles. Every profile contains
	      a set of servers and a set of Resource Managers that must be
	      used to support the Application Program.
	  </p></li></ul></div><p>
      </p><p>
	Below there is a sample configuration file:
	</p><pre class="screen">
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;client&gt;
  &lt;sttsrvs&gt;
    &lt;sttsrv name="server1" domain="AF_INET" address="10.23.45.67" port="2345" /&gt;
    &lt;sttsrv name="server2" domain="AF_INET" address="10.23.46.91" port="3456" /&gt;
  &lt;/sttsrvs&gt;
  &lt;rsrmgrs&gt;
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="OracleXE_stareg" switch_file="/opt/lixa/lib/switch_oracle_stareg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_stareg" switch_file="/opt/lixa/lib/switch_ibmdb2_stareg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
  &lt;/rsrmgrs&gt;
  &lt;profiles&gt;
    &lt;profile name="GT71"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="VZ67"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="AG71"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_2&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/client&gt;
	</pre><p>
	The tags and the
	properties of the XML file are described below:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      <code class="varname">sttsrv</code>: this section is used to describe a
	      state server (a LIXA server instance) that must be reached by any
	      client described below
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">sttsrv/name</code>: a name associated to the 
	      state server; it is a logical name that is referenced by 
	      the profiles defined below
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">domain</code>: it must be the same domain specified 
	      by the listener that must be reached; the listener is configured
	      in <code class="filename">lixad_conf.xml</code> (see above) and may be
	      local or remote
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">address</code>: it must be the same same address 
	      specified by the listener that must be reached; the listener is
	      configured in <code class="filename">lixad_conf.xml</code> (see above)
	      and may be local or remote
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">port</code>: it must be the same port specified
	      by the listener that must be reached; the listener is
	      configured in
	      <code class="filename">lixad_conf.xml</code> (see above)
	      and may be local or remote
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">rsrmgr</code>: this section is used to describe 
	      a resource manager that will be used by the
	      Application Programs configured below (see profiles)
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">rsrmgr/name</code>: a name associated to the 
	      Resource Manager; it is a logical name that is referenced by
	      the profile defined below
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">switch_file</code>: name of the file that contains 
	      the XA switch structure; the file is produced by the installation
	      procedure
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">xa_open_info</code>: it is the string of parameters
	      that must be passed to the Resource Manager by the xa_open() 
	      function call; the content
	      of the string depends on the Resource Manager, please refer to
	      the documentation distributed with the resource manager you
	      are using. The string can not exceed 255 characters
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">xa_close_info</code>: it is the string of parameters
	      that must be passed to the Resource Manager by the xa_open() 
	      function call; the content
	      of the string depends on the Resource Manager, please refer to
	      the documentation distributed with the resource manager you
	      are using. The string can not exceed 255 characters
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">profile</code>: it contains the description of the
	      LIXA every transactional profile must be
	      used by the Application Programs needs to be listed here
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">profile/name</code>: the name associated to the
	      transaction profile; this name is used in different places and
	      it is suggested to avoid special characters, blanks and possibly
	      mixed case (these hints may help you in troubleshooting)
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">profile/sttsrv</code>: the state server that
	      will be used to store
	      the transactional information associated to this profile; more
	      than one state servers can be specified but 
	      <span class="emphasis"><em>only</em></span> 
	      the first one is used with the current release software
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="varname">profile/rsrmgr</code>: every Resource Manager that
	      must be
	      used by the Application Programs associated to this transactional
	      profile needs to be listed here. There is no a limit: you can
	      specify 1, 2, 3, ... resource managers. Avoid useless resource
	      manager because xa_open() and xa_close() will be performed 
	      against all the listed resource managers. If you can choose 
	      between a "dynamic" and a "static" version of the same resource
	      manager, the "dynamic" one is more efficient	    
	  </p></li></ul></div><p>
      </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="Client_configuration_explanation"></a>Client configuration explanation</h4></div></div></div><p>
	  The client configuration file contains three sections:
	  </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
		<code class="varname">sttsrvs</code>: is the list of the LIXA daemons 
		you are
		running inside your network and you will use to manage the
		persistent state of the clients that are using the
		configuration
		file; many times a single LIXA state server is sufficient, but
		sometimes you need more (development, test and production
		environment might use different LIXA servers)
	    </p></li><li style="list-style-type: disc"><p>
		<code class="varname">rsrmgrs</code>: the list of the Resource Managers
		necessary execute the Application Programs; there is no limit
		to the number of resource managers you can specify from a LIXA
		point of view, but you should avoid to list useless 
		Resource Managers to obtain the best performance
	    </p></li><li style="list-style-type: disc"><p>
		<code class="varname">profiles</code>: the list of the available
		transactional profiles for your Application Programs. This
		concept allows you a great configuration flexibility: the same
		configuration file can be used for completely different
		Application Programs and completely different environment.
		As an example, imagine you have 3 distinct applications and
		every application uses a different mix of resource managers; 
		then
		you manage 3 different environments (development, test and
		production): with 9 profiles you can completely model your
		transactional needs (APP1DEV, APP2DEV, APP3DEV, APP1TEST,
		APP2TEST, APP3TEST, APP1PROD, APP2PROD, APP3PROD).
	    </p></li></ul></div><p>
	</p><p>
	  The picture below models an environment that's using the sample
	  <code class="filename">etc/lixac_conf.xml</code>
	  showed above:
	  </p><div class="figure"><a id="config9"></a><p class="title"><b>Figure 3.9. A "real" environment</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Configuration_9.png" alt="A &quot;real&quot; environment" /></div></div></div><p><br class="figure-break" />
	  The scenario is composed of three distinct applications:
	  </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
		GT71: it's an application that uses both an Oracle and an
		IBM DB2 DBMS; most of the transactions need to perform
		distributed transaction processing and the profile specifies
		the static registration versions of the switch files.
	    </p></li><li style="list-style-type: disc"><p>
		AG71: it's an application that uses only an
		IBM DB2 DBMS; only few transactions need to perform
		distributed transaction processing and the profile specifies
		the dynamic registration versions of the switch files. This
		application does not need an XA Transaction Manager because
		it uses only one Resource Manager, but the development team
		decided to use LIXA because it will use a second Resource
		Manager in the next few months.
	    </p></li><li style="list-style-type: disc"><p>
		VZ67: it's an application that uses both an Oracle and an
		IBM DB2 DBMS; only few transactions need to perform
		distributed transaction processing and the profile specifies
		the dynamic registration versions of the switch files.
	    </p></li></ul></div><p>
	  The scenario uses two distinct LIXA state servers: this is an
	  unusual situation but it works.
	</p><p>
	  The <code class="varname">LIXA_PROFILE</code> environment variable must be used 
	  to specify the transactional profile associated to the Application 
	  Program.
	  If you do not specify a valid transactional profile, 
	  the first profile
	  of the list will be applied (in the above example it's
	  <code class="varname">GT71</code>).
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      There is not an alternate way to specify the 
	      transactional profile:
	      <code class="function">tx_open</code> does not allow parameters.
	  </p></div><p>
	  With reference to scenario showed above, Application Program GT71
	  must export <code class="varname">LIXA_PROFILE</code> before execution; if
	  you are using <span class="command"><strong>bash</strong></span> shell you must specifiy
	  something like this
	  </p><pre class="screen">
export LIXA_PROFILE=GT71
	  </pre><p>
	  before application execution. The same applies to Application Program
	  AG71 and VZ67:
	  </p><pre class="screen">
export LIXA_PROFILE=AG71
[...]
export LIXA_PROFILE=VZ67
	  </pre><p>
	</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3376137"></a>Environment variables</h2></div></div></div><p>
      You can use some environment variables to tailor the LIXA configuration
      to your needs. Some environment variables applies only to one component,
      others apply to both client and server LIXA components.
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376152"></a>LIXA_CONFIG_FILE</h3></div></div></div><p>
	  This environment variable can be used to specify an alternate
	  configuration file for your application. 
	  Example: if you are trying a new configuration, but you 
	  wont to modify the default
	  <code class="filename">etc/lixac_conf.xml</code>
	  file, you can export the variable before program execution:
	  </p><pre class="screen">
export LIXA_CONFIG_FILE=/tmp/my_lixac
./myapp
	  </pre><p>
	  <span class="command"><strong>myapp</strong></span> will be executed using the configuration
	  stored inside
	  <code class="filename">/tmp/my_lixac</code>
	  instead of the configuration stored inside the default
	  <code class="filename">etc/lixac_conf.xml</code>
	  client configuration file.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376190"></a>LIXA_CRASH_COUNT</h3></div></div></div><p>
	  This environment variable must be used only in a development
	  environment: after the program crossed the
	  <span class="emphasis"><em>crash point</em></span> as many times as the value of
	  this variable (default = 1), the process crashes. See
	  environemt variable
	  <code class="varname">LIXA_CRASH_POINT</code> too.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376212"></a>LIXA_CRASH_POINT</h3></div></div></div><p>
	  This environment variable must be used only in a development
	  environment: it specifies the crash point inside the LIXA
	  code. The acceptable values for this variable are listed
	  inside the C header file
	  <code class="filename">src/common/lixa_crash.h</code>
	  LIXA project uses 
	  the <code class="function">abort()</code> function to simulated a soft
	  crash.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376236"></a>LIXA_JOB</h3></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	      This environment variable may be very useful to deal with some
	      specific requirements, but it changes how the automatic
	      recovery process works and the final result could be strange
	      or "unpredictable" if you didn't understand the whole picture.
	  </p></div><p>
	  Use this environment variable to associate a specific transactional
	  job identifier instead of the automatically assigned one. 
	  See <a class="xref" href="#Workload_balanced_environments" title="Workload balanced environments">the section called “Workload balanced environments”</a> 
	  for more information.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376265"></a>LIXA_PROFILE</h3></div></div></div><p>
	  This environment variable must be used 
	  to specify the transactional profile associated to the Application 
	  Program.
	  If you do not specify a valid transactional profile, the first
	  profile listed inside 
	  <code class="filename">etc/lixac_conf.xml</code>
	  will be applied.
	  See <a class="xref" href="#Client_configuration_explanation" title="Client configuration explanation">the section called “Client configuration explanation”</a> too.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376299"></a>LIXA_TRACE_MASK</h3></div></div></div><p>
	  This environment variable specifies which internal modules must
	  be traced at run-time. 
	  The C header file
	  <code class="filename">src/common/lixa_trace.h</code>
	  contains the exadecimal value of every internal module; if you 
	  want to trace two or more modules you have make the logical OR
	  among all the desired values.
	</p><p>
	  You are interested in tracing what happens inside 
	  <span class="emphasis"><em>"server listener"</em></span>,
	  <span class="emphasis"><em>"server manager"</em></span> and
	  <span class="emphasis"><em>"server status"</em></span> modules.
	  Looking at file
	  <code class="filename">src/common/lixa_trace.h</code>:
	  </p><pre class="screen">
#define LIXA_TRACE_MOD_SERVER_LISTENER    0x00000004
#define LIXA_TRACE_MOD_SERVER_MANAGER     0x00000008
#define LIXA_TRACE_MOD_SERVER_STATUS      0x00000010
	  </pre><p>
	  the resulting value is 0x0000001C:
	  </p><pre class="screen">
export LIXA_TRACE_MASK=0x00000010
	  </pre><p>
	  The <span class="emphasis"><em>"trace all"</em></span> value is 0xffffffff:
	  </p><pre class="screen">
export LIXA_TRACE_MASK=0xffffffff
	  </pre><p>
	  </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	      Tracing too much is dangerous: it slows down your system and
	      possibly fills-up your filesystems.
	  </p></div><p>
	  Establishing the internal modules that must be traced is a typical
	  troubleshooting task you can acquire working with LIXA project.
	</p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id3375303" href="#id3375303" class="para">10</a>] </sup>
	      The dashed box named "Transaction Manager" was removed to
	      simplify the picture.
	  </p></div><div class="footnote"><p><sup>[<a id="ftn.id3375378" href="#id3375378" class="para">11</a>] </sup>
	  Both the files reside in <code class="filename">/opt/lixa/etc/</code>
	  directory and must be managed by
	  <code class="systemitem">lixa</code> user, the
	  LIXA administrative user
      </p></div><div class="footnote"><p><sup>[<a id="ftn.id3375389" href="#id3375389" class="para">12</a>] </sup>
	  The standard installation procedure installs both the files with
	  default content; it's your responsability to customize the content
	  of the files.
      </p></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id3376360"></a>Chapter 4. Execution</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3376393">Starting the state server</a></span></dt><dd><dl><dt><span class="section"><a href="#Background_execution">Background (<span class="emphasis"><em>daemon</em></span>) execution</a></span></dt><dt><span class="section"><a href="#id3376588">Maintenance mode execution</a></span></dt><dt><span class="section"><a href="#id3376641">Dump execution</a></span></dt><dt><span class="section"><a href="#id3376738">Additional options</a></span></dt></dl></dd><dt><span class="section"><a href="#id3376396">Starting the test utility</a></span></dt><dt><span class="section"><a href="#id3376914">Starting the recovery utility</a></span></dt></dl></div><p>
    Once you have installed (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <i>Installation</i></a>)
    and configured (see <a class="xref" href="#Configuration" title="Chapter 3. Configuration">Chapter 3, <i>Configuration</i></a>)
    your environment, you are ready to run LIXA.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	In this chapter it is assumed you installed the LIXA project
	software at the default path <code class="filename">/opt/lixa</code>; if you
	installed the software at a different path, you'd need to adjust
	the shown commands consequently.
    </p></div><p>
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3376393"></a>Starting the state server</h2></div></div></div><p>
      The first step you must perform is starting the
      <span class="emphasis"><em>state server</em></span>; it's name is 
      <span class="command"><strong>lixad</strong></span> (LIXA daemon). The command
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/sbin/lixad --help
Usage:
  lixad [OPTION...] - LIXA server

Help Options:
  -?, --help             Show help options

Application Options:
  -d, --daemon           Run the process as a daemon
  -m, --maintenance      Start the server in maintenance mode only
  -u, --dump             Dump the content of status files using order [ufs] (u=used, f=free, s=sequential)
  -c, --config-file      Specify an alternate configuration file
  -t, --trace-file       Specify trace file name
  -l, --clean-failed     Clean recovery failed transactions at start-up
  -v, --version          Print package info and exit
    </pre><p>
      displays the available command line options. 
    </p><p>
      If you tried to start the state server without the appropriate 
      privileges it should happen something like this:
      </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/sbin/lixad
tiian@ubuntu:~$ sudo su -c "tail /var/log/daemon.log"
[...]
Mar 31 22:53:10 ubuntu lixad[5891]: LXD000N this process is starting a new LIXA server (lixa package version is 0.5.29)
Mar 31 22:53:10 ubuntu lixad[5891]: LXD015W unable to open pid file '/opt/lixa/var/run.pid'
Mar 31 22:53:10 ubuntu lixad[5891]: LXD004E error (ERROR: 'open' function returned an error condition) while starting manager(s), premature exit
      </pre><p>
      because the process is not able to update the content of the
      <code class="filename">/opt/lixa/var/</code> directory; use the administrative
      user and try again:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
[sudo] password for tiian:
lixa@ubuntu:~$ /opt/lixa/sbin/lixad
      </pre><p>
      Running the command
      without options blocks your shell and runs the state server in
      foreground; this is not terribly useful but it may help you when
      you are debugging some issue. Use these commands, from a different
      terminal, to retrieve the PID
      (process id) and to stop the state server:
    </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      5909  5906  0 22:56 pts/1    00:00:00 /opt/lixa/sbin/lixad
lixa@ubuntu:~$ kill 5909
lixa@ubuntu:~$ exit
logout
    </pre><p>
      Alternatively you can strike ^C to break the foreground execution.
      A foreground execution is generally more useful if some 
      tracing is enabled:
    </p><pre class="screen">
lixa@ubuntu:~$ export LIXA_TRACE_MASK=0x00000001
lixa@ubuntu:~$ /opt/lixa/sbin/lixad 
2011-03-31 22:58:32.244333 [5920/3073509104] lixad/main: starting
2011-03-31 22:58:34.864062 [5920/3073509104] lixad/main: exiting
    </pre><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Background_execution"></a>Background (<span class="emphasis"><em>daemon</em></span>) execution</h3></div></div></div><p>
	The most useful command option is <code class="option">--daemon</code>: it
	allows you to run the state server as a <span class="emphasis"><em>daemon</em></span>
	detached from any terminal:
      </p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      5926     1  0 22:59 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
      </pre><p>
	when running the state server as a daemon you need to perform some 
	special tasks to understand the process is up &amp; running.
	With <span class="command"><strong>ps -ef|grep lixad|grep -v grep</strong></span> you can
	verify the process is running.
	The state server registers its PID in a special file:
	<code class="filename">/opt/lixa/var/run.pid</code>; if the content of the file
	is different than the result retrieved with the <span class="command"><strong>grep</strong></span>
	command, something is not running well.
      </p><pre class="screen">
lixa@ubuntu:~$ cat /opt/lixa/var/run.pid 
5926
      </pre><p>
	To stop a daemonized state server you must use the
	<span class="command"><strong>kill</strong></span> command as shown below:
      </p><pre class="screen">
lixa@ubuntu:~$ kill $(cat /opt/lixa/var/run.pid)
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
      </pre><p>
	The <span class="command"><strong>grep</strong></span> command returns an empty result because
	the state server is not running. The state server publishes some
	messages using the <code class="function">syslog</code> facility; Ubuntu 8.04
	sends default messages to the file
	<code class="filename">/var/log/daemon.log</code>; below there are some standard
	messages:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su -c "cat /var/log/daemon.log|grep lixad|grep 5926"
Mar 31 22:59:11 ubuntu lixad[5926]: LXD014N LIXA server entered daemon status
Mar 31 23:00:48 ubuntu lixad[5926]: LXD019N received signal 15, server immediate shutdown in progress...
Mar 31 23:00:48 ubuntu lixad[5926]: LXD006N server terminated activities
      </pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376588"></a>Maintenance mode execution</h3></div></div></div><p>
	The <code class="option">--maintenance</code> option allows you to start
	the state server to perform some special actions; only special
	clients can connect to the server when the server is operating
	in <span class="emphasis"><em>maintenance</em></span> mode: customer developed
	Application Programs can not perform distributed transactions.
	A special client is <span class="command"><strong>lixar</strong></span>: a command line
	utility designed for recovery purposes
	(see <a class="xref" href="#Recovery" title="Chapter 6. Recovery">Chapter 6, <i>Recovery</i></a> for more information).
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
	A state server that's operating in maintenance mode is not
	serving the LIXA infrastructure and Distributed Transaction
	Processing can not be performed: use this option 
	<span class="emphasis"><em>only</em></span> if you really need it.
      </div><p>
	There's no way to turn a server operating in maintenance mode in
	a server operating in standard mode: you have to stop and start
	the LIXA state server again.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376641"></a>Dump execution</h3></div></div></div><p>
	Use <code class="option">--dump</code> option to get a dump of the content
	of the state currently persisted in the status files. The option
	must specify one or more flags:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      "s": dump all the blocks, in sequential order
	  </p></li><li style="list-style-type: disc"><p>
	      "u": dump all the <span class="emphasis"><em>used</em></span> blocks, 
	      travelling the used block chain
	  </p></li><li style="list-style-type: disc"><p>
	      "f": dump all the <span class="emphasis"><em>free</em></span> blocks, 
	      travelling the free block chain
	  </p></li></ul></div><p>
	You may specify two or more flags on the same command line:
	the output will duplicate some blocks.
      </p><p>
	The example below shows the output produced when dumping the
	content of a single status file with no current transactions
	in progress (the free block chain contains all the blocks):
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --dump f
========================================================================
First file ('/opt/lixa/var/lixad_status1_1') will be dumped
Magic number is: 24848 (24848)
Level is: 1 (1)
Last sync timestamp: 2011-03-31T23:00:48.829787+0200
Size: 10 blocks
Used block chain starts at: 0 (empty chain)
Free block chain starts at: 1
Dumping records following physical order: 0
Dumping records following free block chain: 1
Dumping records following used block chain: 0
------------------------------------------------------------------------
Block: 1, next block in chain: 2
Block type: unknown (0)
------------------------------------------------------------------------
Block: 2, next block in chain: 3
Block type: unknown (0)
------------------------------------------------------------------------
Block: 3, next block in chain: 4
Block type: unknown (0)
------------------------------------------------------------------------
Block: 4, next block in chain: 5
Block type: unknown (0)
------------------------------------------------------------------------
Block: 5, next block in chain: 6
Block type: unknown (0)
------------------------------------------------------------------------
Block: 6, next block in chain: 7
Block type: unknown (0)
------------------------------------------------------------------------
Block: 7, next block in chain: 8
Block type: unknown (0)
------------------------------------------------------------------------
Block: 8, next block in chain: 9
Block type: unknown (0)
------------------------------------------------------------------------
Block: 9, next block in chain: 0
Block type: unknown (0)
      </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
	The dump can be performed while the state server is running:
	the dump will output the content of the currently sinchronized
	status file and you will not be able to see the last updates.
	Dumps performed at different times may produce different
	results if there is a running state server.
      </div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3376738"></a>Additional options</h3></div></div></div><p>
	Some additional options are available: they don't radically change the 
	state server behavior, but supply some features.
      </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3376751"></a>Specifying a different configuration file</h4></div></div></div><p>
	  With option <code class="option">--config-file</code> you can specify a
	  non default configuration file; this option can be useful if you
	  want to test a different configuration without damaging your
	  production config file. It can be used if you want to
	  run different instances of the state server in the same
	  operating system image, too.
	</p><p>
	  Below there is a sample invocation:
	</p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --config-file /tmp/lixad_conf.xml
	</pre></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3376778"></a>Specifying a trace file</h4></div></div></div><p>
	  With option <code class="option">--trace-file</code> you can specify a
	  different trace file instead of the default 
	  <span class="emphasis"><em>stderr</em></span>
	  process stream; this option is especially useful when you are
	  running the state server as a daemon (see
	  <a class="xref" href="#Background_execution" title="Background (daemon) execution">the section called “Background (<span class="emphasis"><em>daemon</em></span>) execution”</a>).
	  Below there is a sample invocation:
	</p><pre class="screen">
lixa@ubuntu:~$ export LIXA_TRACE_MASK=0x01
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon --trace-file /tmp/lixad.trace
lixa@ubuntu:~$ ls -la /tmp/lixad.trace
-rw-r--r-- 1 lixa lixa 349 2011-03-18 16:14 /tmp/lixad.trace
	</pre><p>
	  Take a look to
	  <a class="xref" href="#Tracing" title="Tracing">the section called “Tracing”</a>
	  for additional details.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3376824"></a>Clean-up recovery failed transactions</h4></div></div></div><p>
	  Use option <code class="option">--clean-failed</code> to clean-up the
	  state of the transactions that LIXA was not able to recover
	  automatically: this option is useful to remove useless information
	  from the state file, but you must pay attention to these
	  <span class="emphasis"><em>warnings</em></span>.
	  </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
		If your LIXA installation worked properly, you would not
		need to clean-up the state file.
	    </p></li><li style="list-style-type: disc"><p>
		Removing recovery failed transactions cleans-up the history
		of your issues: you should understand why your state file
		is accumulating recovery failed transaction records
		need to clean-up the state file.
	    </p></li></ul></div><p>
	  Don't use this option without a deep review of the content of
	  <a class="xref" href="#Recovery" title="Chapter 6. Recovery">Chapter 6, <i>Recovery</i></a>.	  
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3376875"></a>Retrieving software version</h4></div></div></div><p>
	  Use option <code class="option">--version</code> to retrieve the 
	  version of the installed software as shown below:
	</p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --version
LIXA: a Libre XA implementation
Copyright (c) 2009-2011, Christian Ferrari; all rights reserved.
License: GPL (GNU Public License) version 2
Package name: lixa; package version: 0.5.29
Access http://sourceforge.net/projects/lixa/ to report bugs and partecipate to the project
	</pre><p>
	  The <span class="command"><strong>lixad</strong></span> command does not start a real state 
	  server: it prints version information on 
	  <span class="emphasis"><em>stdout</em></span> and exits.
	</p></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3376396"></a>Starting the test utility</h2></div></div></div><p>
      The LIXA project supplies a test utility you can use to 
      perform basic tests on your LIXA environment. 
      The command is named <span class="command"><strong>lixat</strong></span> and is
      located in the <code class="filename">bin</code> directory; use 
      <code class="option">--help</code> option to retrieve the list of 
      the available options:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --help
Usage:
  lixat [OPTION...] - LIXA test utility

Help Options:
  -?, --help         Show help options

Application Options:
  -c, --commit       Perform a commit transaction
  -r, --rollback     Perform a rollback transaction
  -v, --version      Print package info and exit
    </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA test utility is a LIXA client program and it 
	does <span class="emphasis"><em>not</em></span> need
	any special authorization to run because it does not need to write
	the content of <code class="filename">/opt/lixa/var/</code> directory.
    </p></div><p>
      The <span class="command"><strong>lixat</strong></span> command does nothing useful except trying 
      to contact the state server and optionally perform a commit and/or 
      rollback dummy distributed transaction.
      Below there's the output of a trivial execution: the program connects
      to the state server, performs tx_open() against all the configured 
      resource managers and performs tx_close() against all the configured
      resource managers.
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat
tx_open(): 0
tx_close(): 0
    </pre><p>
      With <code class="option">--commit</code> option the test program performs a
      dummy commit against all the configured resource managers too:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --commit
tx_open(): 0
tx_begin(): 0
tx_info(): 1
        xid/formatID.gtrid.bqual = 4c495841.080f2b63a3804bfbbdd3347ca7607ba3.ef954655163edff9fee662b12f881c97
tx_commit(): 0
tx_close(): 0
    </pre><p>
      A <span class="emphasis"><em>dummy commit</em></span> does not damage your data because
      the program does not contains instructions that modify the content
      of the resource managers. A dummy rollback can be performed as well:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --rollback
tx_open(): 0
tx_begin(): 0
tx_info(): 1
        xid/formatID.gtrid.bqual = 4c495841.c651f0f2efb249bd92f3f2b5a76741a5.ef954655163edff9fee6-62b12f881c97
tx_rollback(): 0
tx_close(): 0
    </pre><p>
      The test utility can be used to:
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	    check the state server is up and running
	    </p><pre class="screen">
	      tiian@ubuntu:~$ /opt/lixa/bin/lixat
	      tx_open(): -7
	      tiian@ubuntu:~$ echo $?
	      1
	    </pre><p>
	    (the state server is not running)
	</p></li><li style="list-style-type: disc"><p>
	    check the content of <code class="filename">etc/lixac_conf.xml</code>
	    is ok
	    </p><pre class="screen">
	      tiian@ubuntu:~$ export LIXA_PROFILE=XXXX
	      tiian@ubuntu:~$ /opt/lixa/bin/lixat
	      tx_open(): -7
	      tiian@ubuntu:~$ echo $?
	      1
	    </pre><p>
	    (the profile “<span class="quote">XXXX</span>” does not exist)
	</p></li><li style="list-style-type: disc"><p>
	    try different profiles described inside
	    <code class="filename">etc/lixac_conf.xml</code>
	</p></li><li style="list-style-type: disc"><p>
	    ...
	</p></li></ul></div><p>
      You can <span class="emphasis"><em>safely</em></span> experiment by yourself using 
      <span class="command"><strong>lixat</strong></span> command.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3376914"></a>Starting the recovery utility</h2></div></div></div><p>
      The LIXA project supplies a recovery utility you must use to 
      perform some special tasks related to distributed transaction
      recovery. The command is named <span class="command"><strong>lixar</strong></span> and is
      located in the <code class="filename">bin</code> directory; use 
      <code class="option">--help</code> option to retrieve the list of 
      the available options:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixar --help
Usage:
  lixar [OPTION...] - LIXA recovery utility

Help Options:
  -?, --help                      Show help options

Application Options:
  -p, --print                     Print a report of all the prepared and in-doubt transactions compatible with current configuration and profile
  -x, --xid                       Select specified transaction for rollback/commit
  -X, --xid-file                  Select specified file as a list of transaction to rollback/commit
  -c, --commit                    Commit prepared &amp; in-doubt transactions
  -r, --rollback                  Rollback prepared &amp; in-doubt transactions
  -v, --version                   Print package info and exit
  -b, --bypass-bqual-check        Bypass xid branch qualifier check
  -B, --bypass-formatid-check     Bypass xid format id check
  -e, --use-tmendrscan-flag       Use TMENDRSCAN flag for last xa_recover call
    </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA test utility is a LIXA client program and it does 
	<span class="emphasis"><em>not</em></span> need
	any special authorization to run because it does not need to write
	the content of <code class="filename">/opt/lixa/var/</code> directory.
    </p></div><p>
      The usage of the <span class="command"><strong>lixar</strong></span> command is strictly related
      to <span class="emphasis"><em>recovery</em></span> tasks and is explained in
      <a class="xref" href="#Recovery" title="Chapter 6. Recovery">Chapter 6, <i>Recovery</i></a>.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
      All the option except <code class="option">--commit</code> and 
      <code class="option">--rollback</code> are <span class="emphasis"><em>safe</em></span>; only
      specifying “<span class="quote">commit</span>” and “<span class="quote">rollback</span>” can
      damage the state of the data managed by your resource managers.
    </div><p>
      You must start the state server before you can start 
      <span class="command"><strong>lixar</strong></span>; if you don't start the state server, you
      will get something like shown below:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixar
Execution options:
        - print report = no
        - transaction(s) will be committed = no
        - transaction(s) will be rolled back = no
        - bypass xid branch qualifier check = no
        - bypass xid format id check = no
        - use TMENDRSCAN flag for last xa_recover call = no

tx_open() returned TX_FAIL: unable to proceed
    </pre></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="Development"></a>Chapter 5. Development</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id3377231">The first example</a></span></dt><dd><dl><dt><span class="section"><a href="#id3377294">Some details about the example</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example2_ora">An example with a “<span class="quote">real</span>” Resource Manager (Oracle DBMS)</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_Oracle_environment">Set-up Oracle environment</a></span></dt><dt><span class="section"><a href="#Development_start_LIXA_server">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3377870">Build the client program</a></span></dt><dt><span class="section"><a href="#id3377916">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3378002">Check the data table before execution</a></span></dt><dt><span class="section"><a href="#id3378027">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3378104">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3378210">Program execution (static registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example3_db2">An example with IBM DB2 DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_DB2_environment">Set-up DB2 environment</a></span></dt><dt><span class="section"><a href="#id3378662">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3378680">Build the client program</a></span></dt><dt><span class="section"><a href="#id3378743">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3378826">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3378891">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3379116">Program execution (static registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#id3378310">An example with two distinct Resource Manager: Oracle DBMS and
      IBM DB2 DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#id3379321">Build the client program</a></span></dt><dt><span class="section"><a href="#id3379394">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3379542">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3379643">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#id3379649">Program execution (mixed registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example5_pql">An example with PostgreSQL DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_PostgreSQL_environment">Set-up PostgreSQL environment</a></span></dt><dt><span class="section"><a href="#id3380730">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#id3380766">Build the client program</a></span></dt><dt><span class="section"><a href="#id3380862">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#id3380980">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#id3381045">Program execution</a></span></dt></dl></dd></dl></div><p>
    This chapter explains how you can develop your own application
    using the libraries and the tools supplied by LIXA project.
  </p><p>
    LIXA project ships some example C programs you can find in directory
    <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/</code> after
    software installation (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <i>Installation</i></a>).
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3377231"></a>The first example</h2></div></div></div><div class="figure"><a id="develop1"></a><p class="title"><b>Figure 5.1. Deploy model of an example with two dummy resource managers</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Development_1.png" alt="Deploy model of an example with two dummy resource managers" /></div></div></div><br class="figure-break" /><p>
      Create a working directory in a place you are comfortable with:
      </p><pre class="screen">
tiian@ubuntu:~$ cd
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$
      </pre><p>
    </p><p>
      Copy file <code class="filename">example1.c</code> in your working dir:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example1.c .
      </pre><p>
      Substitute “<span class="quote">lixa-X.Y.Z</span>” with the actual version of
      the software you installed.
    </p><p>
      Compile and link the C example program:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ gcc example1.c -Wall -I /opt/lixa/include/ -L /opt/lixa/lib/ -l lixac -o example1
      </pre><p>
      Check the output of the linker:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example1
        linux-gate.so.1 =&gt;  (0xb77a9000)
        liblixac.so.0 =&gt; not found
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7653000)
        /lib/ld-linux.so.2 (0xb77aa000)
      </pre><p>
      <code class="filename">liblixac.so.0</code> library is not resolved because
      the LIXA libraries are not in system standard library path. You can
      bypass the issue exporting <code class="varname">LD_LIBRARY_PATH</code>
      variable and checking it again:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/opt/lixa/lib
tiian@ubuntu:~/tmp$ ldd example1
        linux-gate.so.1 =&gt;  (0xb773f000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7724000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb75d0000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb75cb000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb75c7000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb75c2000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb75b9000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb7508000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb73e8000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb73d4000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb73bc000)
        /lib/ld-linux.so.2 (0xb7740000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb7395000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7380000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb735b000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7356000)
      </pre><p>
      Now you are ready to start your first application:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example1
tx_open(): -7
      </pre><p>
      The <code class="function">tx_open()</code> function returned the value 
      “<span class="quote">-7</span>” (<code class="constant">TX_FAIL</code>) 
      because the state server is not running.
      Start the state server (see <a class="xref" href="#Background_execution" title="Background (daemon) execution">the section called “Background (<span class="emphasis"><em>daemon</em></span>) execution”</a>)
      and try again:
      </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~/tmp$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/opt/lixa/lib
tiian@ubuntu:~/tmp$ ./example1
tx_open(): 0
tx_begin(): 0
tx_commit(): 0
tx_begin(): 0
tx_rollback(): 0
tx_close(): 0
      </pre><p>
      Your first program has connected to the state server and has performed
      two dummy distributed transactions: <span class="emphasis"><em>commit</em></span> and 
      <span class="emphasis"><em>rollback</em></span>.
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3377294"></a>Some details about the example</h3></div></div></div><p>
	You have not specified a specific profile:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

	</pre><p>
	The LIXA client library used the default one, the first listed in
	<code class="filename">etc/lixac_conf.xml</code>. If you inspected the 
	configuration file <code class="filename">/opt/lixa/etc/lixac_conf.xml</code> 
	you would see something like this:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ cat /opt/lixa/etc/lixac_conf.xml
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;client&gt;
  &lt;sttsrvs&gt;
    &lt;sttsrv name="local_1" domain="AF_INET" address="127.0.0.1" port="2345" /&gt;
[...]
    &lt;rsrmgr name="LIXAdummyRM" switch_file="/opt/lixa/lib/switch_lixa_dummyrm.so" xa_open_info="dummy open string" xa_close_info="dummy close string" /&gt;
[...]
  &lt;profiles&gt;
    &lt;profile name="CF05"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;LIXAdummyRM&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;LIXAdummyRM&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="GT71"&gt;
[...]
  &lt;/profiles&gt;
&lt;/client&gt;
	</pre><p>
	The default profile is named “<span class="quote">CF05</span>” and lists two
	resource managers of the same type: “<span class="quote">LIXAdummyRM</span>”;
	the related switch file is the file 
	<code class="filename">/opt/lixa/lib/switch_lixa_dummyrm.so</code>.
	The dummy resource managers supplied by the LIXA project is
	a special trivial resource managers: it ever returns
	<code class="constant">XA_OK</code>. If you are interested in LIXA dummy
	Resource Manager implementation, take a look to the source file
	<code class="filename">src/client/switch/lixa/lixa_dummyrm.c</code>.
	To verify that the program is using the dummy resource manager,
	execute it with <code class="varname">LIXA_TRACE_MASK</code> environment
	variable set to <code class="constant">0x00008000</code>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00008000
tiian@ubuntu:~/tmp$ ./example1
[...]
2011-04-05 22:07:59.953844 [29359/3073444096] client_config_load_switch
2011-04-05 22:07:59.953875 [29359/3073444096] client_config_load_switch: resource manager # 0, name='LIXAdummyRM', switch_file='/opt/lixa/lib/switch_lixa_dummyrm.so'
2011-04-05 22:07:59.954220 [29359/3073444096] client_config_load_switch: module address 0x804e410, function lixa_get_xa_switch found at address 0xb76dd790
2011-04-05 22:07:59.954254 [29359/3073444096] client_config_load_switch: lixa_getxa_switch()-&gt;name = 'lixa_dummyrm', lixa_get_xa_switch()-&gt;flags = 0
2011-04-05 22:07:59.954279 [29359/3073444096] client_config_load_switch: resource manager dynamically registers: false
2011-04-05 22:07:59.954302 [29359/3073444096] client_config_load_switch: resource manager does not support association migration: false
2011-04-05 22:07:59.954325 [29359/3073444096] client_config_load_switch: resource manager supports asynchronous operations: false
2011-04-05 22:07:59.954348 [29359/3073444096] client_config_load_switch: resource manager # 1, name='LIXAdummyRM', switch_file='/opt/lixa/lib/switch_lixa_dummyrm.so'
2011-04-05 22:07:59.954379 [29359/3073444096] client_config_load_switch: module address 0x804e410, function lixa_get_xa_switch found at address 0xb76dd790
2011-04-05 22:07:59.954405 [29359/3073444096] client_config_load_switch: lixa_getxa_switch()-&gt;name = 'lixa_dummyrm', lixa_get_xa_switch()-&gt;flags = 0
2011-04-05 22:07:59.954429 [29359/3073444096] client_config_load_switch: resource manager dynamically registers: false
2011-04-05 22:07:59.954451 [29359/3073444096] client_config_load_switch: resource manager does not support association migration: false
2011-04-05 22:07:59.954474 [29359/3073444096] client_config_load_switch: resource manager supports asynchronous operations: false
[...]
tx_open(): 0
tx_begin(): 0
tx_commit(): 0
tx_begin(): 0
tx_rollback(): 0
2011-04-05 22:08:00.128531 [29359/3073444096] client_unconfig
2011-04-05 22:08:00.128883 [29359/3073444096] client_unconfig: acquiring exclusive mutex
2011-04-05 22:08:00.129174 [29359/3073444096] client_config_unload_switch
2011-04-05 22:08:00.129399 [29359/3073444096] client_config_unload_switch: resource manager # 0, defined in config as 'LIXAdummyRM', module address 0x804e410, xa_switch-&gt;name='lixa_dummyrm', xa_switch-&gt;flags=0
2011-04-05 22:08:00.129594 [29359/3073444096] client_config_unload_switch: resource manager # 1, defined in config as 'LIXAdummyRM', module address 0x804e410, xa_switch-&gt;name='lixa_dummyrm', xa_switch-&gt;flags=0
2011-04-05 22:08:00.129852 [29359/3073444096] client_config_unload_switch/excp=1/ret_cod=0/errno=0
2011-04-05 22:08:00.130024 [29359/3073444096] client_unconfig/xmlCleanupParser
2011-04-05 22:08:00.130215 [29359/3073444096] client_unconfig: releasing exclusive mutex
2011-04-05 22:08:00.130371 [29359/3073444096] client_unconfig/excp=2/ret_cod=0/errno=0
tx_close(): 0
	</pre><p>
      </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example2_ora"></a>An example with a “<span class="quote">real</span>” Resource Manager (Oracle DBMS)</h2></div></div></div><div class="figure"><a id="develop2"></a><p class="title"><b>Figure 5.2. Deploy model of an example with Oracle Database Server</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Development_2.png" alt="Deploy model of an example with Oracle Database Server" /></div></div></div><br class="figure-break" /><p>
      Using a real Resource Manager, like a DBMS, requires some extra effort
      because you have to set-up the environment needed by the Resource
      Manager. The example explained in this section was developed using
      Oracle Database 10g Release 2 (10.2) Express Edition: if you used 
      a different version, you might need to fix some of the details 
      showed by this example.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  If you did not yet installed the software provided by Oracle,
	  please refer to the official Oracle site to download the
	  software and to pick-up the information necessary to install 
	  and configure
	  the database. This manual does not give you information related
	  to Oracle technology: it is assumed you already installed and
	  configured the database.
      </p></div><p>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
      The LIXA software must be configured to support the Oracle Database
      Server resource manager as explained in 
      <a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
      </p></div><p>
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_Oracle_environment"></a>Set-up Oracle environment</h3></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3377589"></a>Start-up the Oracle server</h4></div></div></div><p>
	  If the database server was not running, you could start it
	  with these commands:
	  </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe enable
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe start
Starting Oracle Net Listener.
Starting Oracle Database 10g Express Edition Instance.

	  </pre><p>
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3377615"></a>Create the XA related views</h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The steps explained below might be not necessary with some
	    versions of the Oracle software, but they are necessary
	    with Oracle XE 10.2.0.1.
	</p></div><p>
	  First of all you must be able to connect as “<span class="quote">SYSDBA</span>”
	  from a terminal session; the commands below show what happens when
	  I connect to the Oracle server using the user 
	  <code class="systemitem">sys</code> with password
	  “<span class="quote">oracle</span>”
	  <sup>[<a id="id3377659" href="#ftn.id3377659" class="footnote">13</a>]</sup>:
	  </p><pre class="screen">
tiian@ubuntu:~$ sudo su - oracle
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
oracle@ubuntu:~$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:23:56 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	  You must check the file <code class="filename">xaview.sql</code>:
	  </p><pre class="screen">
oracle@ubuntu:~$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r-- 1 oracle dba 1754 2006-02-24 06:18 /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/admin/xaview.sql
	  </pre><p>
	  It contains the SQL instructions necessary to create two specific
	  system views that could be not defined in your database; the
	  following commands are related to a database that contains
	  the desired views:
	  </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:32:45 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;

no rows selected

SQL&gt; select * from v$xatrans$;

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	  If the command failed the views would be not defined and you
	  would get something like this:
	  </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:20:01 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;
select * from v$pending_xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; select * from v$xatrans$;
select * from v$xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	  you can create them with a command like this:
	  </p><pre class="screen">
oracle@ubuntu:~$ cat $ORACLE_HOME/rdbms/admin/xaview.sql | sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:25:48 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; DROP VIEW v$xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; DROP VIEW v$pending_xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8
View created.

SQL&gt; SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8    9   10   11
View created.

SQL&gt; SQL&gt; SQL&gt; Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3377748"></a>Authorize the XA related views</h4></div></div></div><p>
	  The example programs supplied by the LIXA project are designed
	  to use the 
	  <code class="systemitem">hr</code> user; you 
	  <span class="emphasis"><em>must</em></span> grant
	  the necessary privileges to all the users you want to use for
	  your Application Programs. The below commands show how to grant
	  the necessary privileges to
	  <code class="systemitem">hr</code>:
	  </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; grant select on dba_pending_transactions to hr;

Grant succeeded.

SQL&gt; grant select on v$pending_xatrans$ to hr;

Grant succeeded.

SQL&gt; grant select on v$xatrans$ to hr;

Grant succeeded.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    If the user
	    <code class="systemitem">hr</code> did not exist and
	    the above commands failed,
	    you should read Oracle documentation and pick-up the necessary
	    information to create it.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3377808"></a>Unlock “<span class="quote"><code class="systemitem">hr</code></span>” Oracle user</h4></div></div></div><p>
	  The example programs supplied by the LIXA project are designed
	  to use the 
	  <code class="systemitem">hr</code> user; it might be 
	  <span class="emphasis"><em>locked</em></span> after Oracle software installation.
	  The below commands show how to unlock it:
	  </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; alter user hr account unlock;

User altered.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	  </pre><p>
	  You may perform the same operation using the graphical (web based)
	  interface.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Development_start_LIXA_server"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3377870"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu:~/tmp$ gcc example2_ora.c -Wall \
&gt; -I /opt/lixa/include/ -L /opt/lixa/lib/ -l lixac \
&gt; -I /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public -L /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -o example2_ora
	</pre><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb776d000)
        liblixac.so.0 =&gt; not found
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7616000)
        /lib/ld-linux.so.2 (0xb776e000)
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3377916"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are three unresolved references that can be fixed setting up
	the environment properly:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:/opt/lixa/lib

tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:/opt/lixa/lib
	</pre><p>
	Check again the executable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb7749000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb772f000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb697b000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb6775000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb6621000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb661d000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb6619000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb6614000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb660a000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb6559000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb6439000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb6426000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb640e000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb63e9000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb63d0000)
        /lib/ld-linux.so.2 (0xb774a000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb63a9000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb6394000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb6390000)
	</pre><p>
	Set-up the necessary environment variables:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN

tiian@ubuntu:~/tmp$ echo $ORACLE_HOME

tiian@ubuntu:~/tmp$ export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server

tiian@ubuntu:~/tmp$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
tiian@ubuntu:~/tmp$ export PATH=$PATH:$ORACLE_HOME/bin
tiian@ubuntu:~/tmp$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin

tiian@ubuntu:~/tmp$ echo $ORACLE_SID

tiian@ubuntu:~/tmp$ export ORACLE_SID=XE
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
	</pre><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LD_LIBRARY_PATH</code>,
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">ORACLE_HOME</code>,
	<code class="varname">ORACLE_SID</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378002"></a>Check the data table before execution</h3></div></div></div><p>
	Execute the below commands:
	</p><pre class="screen">
tiian@ubuntu:~$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 14 22:04:55 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	</pre><p>
	That's OK because the table does not contain the row we 
	are going to insert.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378027"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	“<span class="quote">ORA_DYN</span>”, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	“<span class="quote">OracleXE_dynreg</span>”, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
	</pre><p>
	we can discover that our application will access the Oracle
	database using <code class="systemitem">hr</code>
	user and writing the trace file to directory <code class="filename">/tmp</code>
	(see <code class="constant">LogDir</code>)
	<sup>[<a id="id3378084" href="#ftn.id3378084" class="footnote">14</a>]</sup>. Verify no trace file exists:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378104"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	Execute the client program as shown below:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
	</pre><p>
	Check the table after program execution:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:34:23 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	</pre><p>
	The example program <code class="filename">example2_ora</code> inserted a
	row in table <code class="constant">COUNTRIES</code>. Take a look to the
	trace produced by the Oracle client library:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
-rw-r--r-- 1 tiian tiian 1723 2011-04-10 10:33 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

103352.5300.3057182448.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

103352.5300.3057182448.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

103352.5300.3057182448.0:
xaolgn: sqlxrc/sqlxss completed

103352.5300.3057182448.0:
xaolgn2: return XA_OK

103352.5300.3057182448.0:
xaoopen: xaolgn completed

103352.5300.3057182448.0:
xaoopen: return 0

103352.5300.3057182448.0:
ax_reg: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCITransStart: Attempting

103352.5300.3057182448.0:
OCITransStart: Succeeded

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=3

103352.5300.3057182448.0:
xaoend: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x4000000

103352.5300.3057182448.0:
OCITransDetach: Attempting

103352.5300.3057182448.0:
OCITransDetach: Succeeded

103352.5300.3057182448.0:
xaoend: return 0

103352.5300.3057182448.0:
xaocommit: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x40000000

103352.5300.3057182448.0:
OCITransCommit: Attempting

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=1

103352.5300.3057182448.0:
OCITransCommit: Succeeded

103352.5300.3057182448.0:
xaocommit: rtn 0

103352.5300.3057182448.0:
xaoclose: xa_info=, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCIServerDetach: Attempting

103352.5300.3057182448.0:
OCIServerDetach: Succeeded

103352.5300.3057182448.0:
xaoclose: rtn 0
	</pre><p>
	The <code class="function">ax_reg</code> function was called because the
	dynamic registration configuration was used 
	(<code class="constant">LIXA_PROFILE=ORA_DYN</code>). 
	Now you can remove
	the inserted record using the same program:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
	</pre><p>
	Check the content of the table again:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:40:25 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	</pre><p>
	The row was deleted. Please remove the trace file before a new
	execution:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ rm /tmp/xa_NULL04102011.trc
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378210"></a>Program execution (static registration)</h3></div></div></div><p>
	Switch from dynamic registration to static registration:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA
	</pre><p>
	Execute the program again:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:53:05 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	</pre><p>
	Inspect the produced trace file:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa_*
-rw-r--r-- 1 tiian tiian 1661 2011-04-10 10:52 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

105236.5392.3057456880.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

105236.5392.3057456880.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

105236.5392.3057456880.0:
xaolgn: sqlxrc/sqlxss completed

105236.5392.3057456880.0:
xaolgn: return XA_OK

105236.5392.3057456880.0:
xaoopen: xaolgn completed

105236.5392.3057456880.0:
xaoopen: return 0

105236.5392.3057456880.0:
xaostart: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCITransStart: Attempting

105236.5392.3057456880.0:
OCITransStart: Succeeded

105236.5392.3057456880.0:
xaostart: return XA_OK

105236.5392.3057456880.0:
xaoend: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x4000000

105236.5392.3057456880.0:
OCITransDetach: Attempting

105236.5392.3057456880.0:
OCITransDetach: Succeeded

105236.5392.3057456880.0:
xaoend: return 0

105236.5392.3057456880.0:
xaocommit: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x40000000

105236.5392.3057456880.0:
OCITransCommit: Attempting

105236.5392.3057456880.0:
OCITransCommit: Succeeded

105236.5392.3057456880.0:
xaocommit: rtn 0

105236.5392.3057456880.0:
xaoclose: xa_info=, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCIServerDetach: Attempting

105236.5392.3057456880.0:
OCIServerDetach: Succeeded

105236.5392.3057456880.0:
xaoclose: rtn 0
	</pre><p>
	The <code class="function">xa_start (xaostart)</code> function was called 
	because the static registration configuration was used 
	(<code class="constant">LIXA_PROFILE=ORA_STA</code>). 
	Remove the inserted row again:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 11:01:32 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	</pre><p>
	You successfully executed a program that uses Oracle Database Server
	as a Resource Manager.
      </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example3_db2"></a>An example with IBM DB2 DBMS</h2></div></div></div><div class="figure"><a id="develop3"></a><p class="title"><b>Figure 5.3. Deploy model of an example with IBM DB2 DBMS</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Development_3.png" alt="Deploy model of an example with IBM DB2 DBMS" /></div></div></div><br class="figure-break" /><p>
      This example was developed using DB2 Express-C 9.7 for Linux (Ubuntu).
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by IBM,
	please refer to the official IBM site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to IBM DB2 technology: it is assumed you already installed and
	configured the database.
    </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the IBM DB2
	server resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_DB2_environment"></a>Set-up DB2 environment</h3></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3378362"></a>Start-up the DB2 server</h4></div></div></div><p>
	  If your server didn't start-up automatically at boot time, you
	  could start it with the following commands:
	  </p><pre class="screen">
tiian@ubuntu:~$ ps -ef | grep db2 | grep -v grep
tiian@ubuntu:~$ sudo /etc/init.d/db2exc start
  * Starting DAS:                       done.
  * Instance db2inst1 ( db2c_db2inst1 ):        done.
  * Activating database SAMPLE          done.
tiian@ubuntu:~$ ps -ef | grep db2 | grep -v grep
dasusr1  22959     1  0 10:54 pts/2    00:00:00 /home/dasusr1/das/adm/db2dasrrm
root     23190     1  2 10:54 pts/2    00:00:00 db2wdog                         
db2inst1 23192 23190  4 10:54 pts/2    00:00:01 db2sysc                         
root     23193 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
root     23194 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
root     23195 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
db2inst1 23206 23190  2 10:54 pts/2    00:00:00 db2acd   ,0,0,0,1,0,0,0,1,0,8a6614,14,1e014,2,0,1,11fd0,0x12600000,0x12600000,1600000,740002,2,a0800d
	  </pre><p>
	  Switch to user <code class="systemitem">db2inst1</code>,
	  try to connect to database “<span class="quote">SAMPLE</span>”:
	  </p><pre class="screen">
tiian@ubuntu:~$ sudo su - db2inst1
db2inst1@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to sample

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = DB2INST1
 Local database alias   = SAMPLE

	  </pre><p>
	  Check the tables “<span class="quote">ORG</span>” and “<span class="quote">DEPT</span>” exist
	  and contain some data:
	  </p><pre class="screen">
db2 =&gt; select * from ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

db2 =&gt; select * from DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

	  </pre><p>
	  OK, the “<span class="quote">ORG</span>” and “<span class="quote">DEPT</span>”
	  tables are populated. 
	  If something went wrong, you should refer to IBM DB2
	  documentation to fix the issue before the next step because
	  you would not be able to execute the sample program without a
	  basic running installation.
	</p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="Development_setup_DB2_user_customization"></a>User customization</h4></div></div></div><p>
	  We want to execute our example program with a generic user,
	  not just using <code class="systemitem">db2inst1</code>
	  because that's the system user dedicated to the database
	  instance execution. The commands below explain as the generic
	  user <code class="systemitem">tiian</code> (my own 
	  user) can be used instead of 
	  <code class="systemitem">db2inst1</code>.
	</p><p>
	  Grant <code class="constant">DBADM</code> privilege to the user
	  <code class="systemitem">tiian</code>:
	  </p><pre class="screen">
db2 =&gt; grant DBADM on database to user tiian
DB20000I  The SQL command completed successfully.
	  </pre><p>
	  <code class="constant">DBADM</code> is not the lowest authorization
	  level necessary to execute our example, but for the sake of 
	  this example it's a “<span class="quote">good enought</span>” choice.
	</p><p>
	  Add something like the 4 lines below to your
	  <code class="filename">$HOME/.profile</code> or equivalent profile
	  configuration:
	  </p><pre class="screen">
# The following three lines have been added by IBM DB2 instance utilities.
if [ -f /home/db2inst1/sqllib/db2profile ]; then
    . /home/db2inst1/sqllib/db2profile
fi
	  </pre><p>
	  Then login again and check your environment:
	  </p><pre class="screen">
tiian@ubuntu:~$ env|grep -i db2
DB2INSTANCE=db2inst1
LD_LIBRARY_PATH=/home/db2inst1/sqllib/lib32
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/db2inst1/sqllib/bin:/home/db2inst1/sqllib/adm:/home/db2inst1/sqllib/misc:/home/db2inst1/sqllib/db2tss/bin
CLASSPATH=/home/db2inst1/sqllib/java/db2java.zip:/home/db2inst1/sqllib/java/db2jcc.jar:/home/db2inst1/sqllib/java/sqlj.zip:/home/db2inst1/sqllib/function:/home/db2inst1/sqllib/java/db2jcc_license_cu.jar:.
	  </pre><p>
	  As shown above,
	  <code class="varname">DB2INSTANCE</code>, <code class="varname">LD_LIBRARY_PATH</code>,
	  <code class="varname">PATH</code> variables should refer to DB2 stuff too.
	  Connect to the database using your own user instead of
	  <code class="systemitem">db2inst1</code>:
	  </p><pre class="screen">
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to sample

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

db2 =&gt; quit
DB20000I  The QUIT command completed successfully.
	  </pre><p>
	  You have just verified that a generic user, like
	  <code class="systemitem">tiian</code>	
	  in the example above, can connect to the database and execute
	  some query.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378662"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378680"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example3_db2.c .
tiian@ubuntu:~/tmp$ gcc example3_db2.c -Wall \
&gt; -I /opt/lixa/include/ -L /opt/lixa/lib/ -l lixac -I /opt/ibm/db2/V9.7/include/ -L /opt/ibm/db2/V9.7/lib32/ -l db2 \
&gt; -o example3_db2
	</pre><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example3_db2
        linux-gate.so.1 =&gt;  (0xb7711000)
        liblixac.so.0 =&gt; not found
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb61cf000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb607f000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb604d000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb6049000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb6030000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb6026000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb6001000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb5fd4000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb5966000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb5925000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb591a000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb5907000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb5602000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb5592000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb557e000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb548b000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb5480000)
        /lib/ld-linux.so.2 (0xb7712000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb5476000)
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378743"></a>Set-up LIXA environment</h3></div></div></div><p>
	There is an unresolved reference to liblixac.so.0: it can be fixed 
	setting up the proper environment variable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/home/db2inst1/sqllib/lib32
tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/home/db2inst1/sqllib/lib32:/opt/lixa/lib
	</pre><p>
	Check again the executable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example3_db2
        linux-gate.so.1 =&gt;  (0xb775f000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7744000)
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb6212000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb60b4000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb60b0000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb60ac000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb60a7000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb609e000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5fed000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb5ecc000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb5eb9000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb5ea1000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb5e6e000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb5e64000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb5e3f000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb5e12000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb57a4000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb5763000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb5758000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb5745000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb5440000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb53d0000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb53bc000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb52c9000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb52be000)
        /lib/ld-linux.so.2 (0xb7760000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb5297000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb5282000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb527d000)
	</pre><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
DB2_DYN
	</pre><p>
	No additional DB2 variables are needed because they are automatically
	set at login (see <a class="xref" href="#Development_setup_DB2_environment" title="Set-up DB2 environment">the section called “Set-up DB2 environment”</a>).
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378826"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	“<span class="quote">DB2_DYN</span>”, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	“<span class="quote">IBMDB2_dynreg</span>”, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the DB2 database is configured for XA
	<sup>[<a id="id3378860" href="#ftn.id3378860" class="footnote">15</a>]</sup>.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3378891"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to “<span class="quote">SAMPLE</span>” DB2 database and the second
	one pointing to the directory where the compiled program
	<code class="filename">example3_db2</code> lives.
	First teminal session:
	</p><pre class="screen">
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to SAMPLE

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

	</pre><p>
	Second teminal session:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 28
drwxr-xr-x  2 tiian tiian  4096 2011-04-22 16:26 .
drwxr-xr-x 40 tiian tiian  4096 2011-04-18 22:55 ..
-rwxr-xr-x  1 tiian tiian 11030 2011-04-22 16:26 example3_db2
-rw-r--r--  1 tiian tiian  5898 2011-04-22 16:23 example3_db2.c
	</pre><p>
	Check the content of “<span class="quote">DB2INST1.ORG</span>” table before
	program execution:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

	</pre><p>
	Execute the program:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert org
	</pre><p>
	Check the content of the table again:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver
     150 Europe             231 R&amp;D        Mojan

  9 record(s) selected.

	</pre><p>
	The example program inserted the last row! You can execute it again
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert org
	</pre><p>
	and it inserts another row:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver
     150 Europe             231 R&amp;D        Mojan
     150 Europe             231 R&amp;D        Mojan

  10 record(s) selected.

	</pre><p>
	Because there is no an unique constraint on this table; if you
	want to check an error while inserting, use “<span class="quote">DEPT</span>”
	table instead.
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

	</pre><p>
	Try to insert the same row twice:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept
Unable to execute the SQL statement ('INSERT INTO DB2INST1.DEPT (DEPTNO, DEPTNAME, ADMRDEPT) VALUES('Z99', 'RESEARCH &amp; DEVELOPMENT', 'E01')'): -1
	</pre><p>
	Check the table content:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  15 record(s) selected.

	</pre><p>
	Only one record was inserted. As a final step, clean up both the
	tables:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
tiian@ubuntu:~/tmp$ ./example3_db2 delete org
	</pre><p>
	and check the tables were cleaned-up:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

	</pre><p>
	To verify the LIXA Transaction Manager and DB2 Resource Manager
	are using the dynamic transaction registration, you can inspect
	the trace produced by the LIXA client library:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept 2&gt;&amp;1 | grep ax_reg
2011-04-22 22:08:40.650458 [6654/3039381232] ax_reg: rmid=0, xid=0xbfcd65d0, flags=0x0
2011-04-22 22:08:40.650858 [6654/3039381232] ax_reg: the application program has started a transaction (TX states S3); this XID '4c495841.9a73b024b7ab4018915b54761d3dcd79.e41205820a9c722218578c0eeec6a27c' will be returned
2011-04-22 22:08:40.651156 [6654/3039381232] ax_reg: sending 153 bytes to the server for step 8
2011-04-22 22:08:40.651316 [6654/3039381232] ax_reg/excp=7/ret_cod=0/errno=2
	</pre><p>
	I don't know how you can retrieve the same information on the
	DB2 side, but there probably is a way to do it. Clean-up again
	the table...
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379116"></a>Program execution (static registration)</h3></div></div></div><p>
	If you desire static transaction registration instead of the
	dynamic one, you can switch the <code class="varname">LIXA_PROFILE</code>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
DB2_STA
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
	</pre><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that “<span class="quote">DB2_STA</span>” is associated to static registration.
	Execute the program:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept 2&gt;&amp;1 | grep xa_start
2011-04-22 22:19:45.717003 [6745/3038836464] lixa_xa_start
[...]
2011-04-22 22:19:45.758075 [6745/3038836464] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-04-22 22:19:45.758321 [6745/3038836464] lixa_xa_start: sending 210 bytes to the server for step 24
2011-04-22 22:19:45.758681 [6745/3038836464] lixa_xa_start/excp=10/ret_cod=0/errno=2
	</pre><p>
	Check the content of the table:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  15 record(s) selected.

	</pre><p>
	And clean the table again:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
	</pre><p>
      </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3378310"></a>An example with two distinct Resource Manager: Oracle DBMS and
      IBM DB2 DBMS</h2></div></div></div><div class="figure"><a id="develop4"></a><p class="title"><b>Figure 5.4. Deploy model of an example showing a distributed transaction with Oracle and IBM DB2</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Development_4.png" alt="Deploy model of an example showing a distributed transaction with Oracle and IBM DB2" /></div></div></div><br class="figure-break" /><p>
      This example should be considered a milestone because it shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (Oracle Database Server and IBM DB2 DBMS)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Development">Chapter 5, <i>Development</i></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by Oracle,
	please refer to the official Oracle site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to Oracle technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by IBM,
	please refer to the official IBM site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to IBM DB2 technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the Oracle Database
	Server and the IBM DB2 resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server --with-ibmdb2=/opt/ibm/db2/V9.7
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up Oracle environment">the section called “Set-up Oracle environment”</a>
	    to set-up a running environment for Oracle Database Server
	</p></li><li style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_DB2_environment" title="Set-up DB2 environment">the section called “Set-up DB2 environment”</a>
	    to set-up a running environment for IBM DB2 server
	</p></li><li style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379321"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example4_ora_db2.c .
tiian@ubuntu:~/tmp$ gcc example4_ora_db2.c -Wall \
&gt; -I /opt/lixa/include/ -L /opt/lixa/lib/ -l lixac \
&gt; -I /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public -L /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -I /opt/ibm/db2/V9.7/include/ -L /opt/ibm/db2/V9.7/lib32/ -l db2 \
&gt; -o example4_ora_db2
	</pre><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example4_ora_db2
        linux-gate.so.1 =&gt;  (0xb779c000)
        liblixac.so.0 =&gt; not found
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb6259000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb610a000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb60d7000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb60d3000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb60bb000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb60b1000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb608c000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb605e000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb59f0000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb59b0000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb59a5000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb5992000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb568d000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb561c000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb5609000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb5516000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb550b000)
        /lib/ld-linux.so.2 (0xb779d000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb5501000)
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379394"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are three unresolved references that can be fixed setting up
	the environment properly; you can fix the environment manually or
	using these scripts supplied by Oracle and IBM:
	<code class="filename">/home/db2inst1/sqllib/db2profile</code> and
	<code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	</p><pre class="screen">
tiian@ubuntu:~$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh<sup>[<a id="id3379422" href="#ftn.id3379422" class="footnote">16</a>]</sup>
tiian@ubuntu:~$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:/home/db2inst1/sqllib/lib32
tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:/home/db2inst1/sqllib/lib32:/opt/lixa/lib
	</pre><p>
	Check again the executable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example4_ora_db2
        linux-gate.so.1 =&gt;  (0xb775d000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7743000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb698f000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb6789000)
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb5257000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb50fa000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb50f6000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb50f2000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb50ec000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb50e3000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5032000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb4f12000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb4eff000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb4ee7000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb4ec1000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb4ea9000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb4e76000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb4e6c000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb4e3f000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb47d1000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb4791000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb4785000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb4772000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb446d000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb43fd000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb43ea000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb42f6000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb42eb000)
        /lib/ld-linux.so.2 (0xb775e000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb42c4000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb42af000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb42ab000)
	</pre><p>
	Set-up the necessary environment variables:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN_DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN_DB2_SYN
	</pre><p>
	The below environment variables were set by the previous sourced
	script; take a look to them:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/db2inst1/sqllib/bin:/home/db2inst1/sqllib/adm:/home/db2inst1/sqllib/misc:/home/db2inst1/sqllib/db2tss/bin
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
	</pre><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LD_LIBRARY_PATH</code>,
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">ORACLE_HOME</code>,
	<code class="varname">ORACLE_SID</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379542"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	“<span class="quote">ORA_DYN_DB2_DYN</span>”, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="ORA_DYN_DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	“<span class="quote">OracleXE_dynreg</span>” and “<span class="quote">IBMDB2_stareg</span>”, 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<sup>[<a id="id3379587" href="#ftn.id3379587" class="footnote">17</a>]</sup>. 
	Verify no (Oracle) trace file exists:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	</pre><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379643"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to “<span class="quote">SAMPLE</span>” DB2 database,
	the second one connected to Oracle database and the
	third one pointing to the directory where the compiled program 
	example4_ora_db2 lives.
	</p><table xmlns="" frame="box" id="id3379662"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to SAMPLE

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

db2 =&gt;
	  </pre></td></tr></tbody></table><p>
	</p><table xmlns="" frame="box" id="id3379679"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ sqlplus "hr/hr"                                                 
SQL*Plus: Release 10.2.0.1.0 - Production on Tue May 3 21:52:06 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt;
	  </pre></td></tr></tbody></table><p>
	</p><table xmlns="" frame="box" id="id3379718"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 36
drwxr-xr-x  2 tiian tiian  4096 2011-05-03 21:53 .
drwxr-xr-x 40 tiian tiian  4096 2011-05-03 21:04 ..
-rwxr-xr-x  1 tiian tiian 14422 2011-05-02 21:53 example4_ora_db2
-rw-r--r--  1 tiian tiian 11892 2011-05-02 21:52 example4_ora_db2.c
	  </pre></td></tr></tbody></table><p>
	Check the content of the Oracle table (“<span class="quote">COUNTRIES</span>”):
	</p><table xmlns="" frame="box" id="id3379753"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table><p>
	Check the content of the DB2 tables (“<span class="quote">DB2INST1.ORG</span>” and
	“<span class="quote">DB2INST1.DEPT</span>”):
	</p><table xmlns="" frame="box" id="id3379781"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table><p>
	<span class="command"><strong>example4_ora_db2</strong></span> program accepts some arguments
	you can tune to experiment different transactions:
	</p><div class="itemizedlist"><ul type="bullet"><li style="list-style-type: disc"><p>
	      <code class="option">iorg</code>: insert a row into 
	      “<span class="quote">DB2INST1.ORG</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">dorg</code>: delete rows from 
	      “<span class="quote">DB2INST1.ORG</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">idept</code>: insert a row into 
	      “<span class="quote">DB2INST1.DEPT</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">ddept</code>: delete rows from 
	      “<span class="quote">DB2INST1.DEPT</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">icountries</code>: insert a row into 
	      “<span class="quote">COUNTRIES</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">dcountries</code>: delete rows from 
	      “<span class="quote">COUNTRIES</span>” table
	  </p></li><li style="list-style-type: disc"><p>
	      <code class="option">rollback</code>: force a transaction rollback (the
	      default behavior is commit)
	  </p></li></ul></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><table xmlns="" frame="box" id="id3379906"><thead><tr><td>[Third terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
INSERT INTO COUNTRIES executed!
INSERT INTO DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table><p>
	Now you can verify the content of the tables after the transaction:
	</p><table xmlns="" frame="box" id="id3379931"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1
	  </pre></td></tr></tbody></table><p>
	</p><table xmlns="" frame="box" id="id3379944"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.

db2 =&gt;  select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  1 record(s) selected.
	  </pre></td></tr></tbody></table><p>
	With the opposite command you can remove the rows from the tables:
	</p><table xmlns="" frame="box" id="id3379971"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 dorg dcountries ddept
DELETE FROM DB2INST1.ORG executed!
DELETE FROM COUNTRIES executed!
DELETE FROM DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table><p>
	and check the content of the tables again:
	</p><table xmlns="" frame="box" id="id3380005"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table><p>
	</p><table xmlns="" frame="box" id="id3380026"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table><p>
	This sequence shows what happens trying to insert a duplicated row
	in a table that does not allow duplicates:
	</p><table xmlns="" frame="box" id="id3380032"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
INSERT INTO COUNTRIES executed!
INSERT INTO DB2INST1.DEPT executed!
COMMIT performed!
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
OCIStmtExecute/Error while executing INSERT statement; ocirc = -1
ROLLBACK performed!
	  </pre></td></tr></tbody></table><p>
	Verify that table “<span class="quote">DB2INST1.ORG</span>” contains only one row
	because the second transaction was rolled back after the error
	occurred while inserting a duplicated row in “<span class="quote">COUNTRIES</span>”
	table:
	</p><table xmlns="" frame="box" id="id3380088"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.
	  </pre></td></tr></tbody></table><p>
	Remove the rows from the tables:
	</p><table xmlns="" frame="box" id="id3380111"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 dorg dcountries ddept
DELETE FROM DB2INST1.ORG executed!
DELETE FROM COUNTRIES executed!
DELETE FROM DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table><p>
	We can introduce the usage of the <code class="option">rollback</code> option 
	to check dynamic registration behavior:
	</p><table xmlns="" frame="box" id="id3380138"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:35:07.919522 [8962/3023124208] ax_reg: rmid=1, xid=0xbfe8d1f0, flags=0x0
2011-05-04 22:35:07.920026 [8962/3023124208] ax_reg: the application program has started a transaction (TX states S3); this XID '4c495841.47b3b61569764774bfc1e5f79ef725ae.818e85f29a0c09e22f0c75f89ca17658' will be returned
2011-05-04 22:35:07.920276 [8962/3023124208] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:35:07.920527 [8962/3023124208] ax_reg/excp=7/ret_cod=0/errno=2
2011-05-04 22:35:07.921592 [8962/3023124208] ax_reg: rmid=0, xid=0xbfe8b09c, flags=0x0
2011-05-04 22:35:07.921812 [8962/3023124208] ax_reg: the application program has started a transaction (TX states S3); this XID '4c495841.47b3b61569764774bfc1e5f79ef725ae.818e85f29a0c09e22f0c75f89ca17658' will be returned
2011-05-04 22:35:07.921979 [8962/3023124208] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:35:07.922128 [8962/3023124208] ax_reg/excp=7/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table><p>
	The second resource manager for profile
	“<span class="quote">ORA_DYN_DB2_DYN</span>” is “<span class="quote">IBMDB2_dynreg</span>”
	and it calls <code class="function">ax_reg</code> with 
	<em class="parameter"><code>rmid=1</code></em> before the first resource manager
	that's “<span class="quote">OracleXE_dynreg</span>” and calls
	<code class="function">ax_reg</code> with <em class="parameter"><code>rmid=0</code></em>
	later.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3379649"></a>Program execution (mixed registration)</h3></div></div></div><p>
	Switching to a different registration type is quite easy; we can start
	with dynamic registration for Oracle and static registration for
	IBM DB2:
	</p><table xmlns="" frame="box" id="id3380213"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN_DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN_DB2_STA
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:47:11.812256 [9122/3022382832] ax_reg: rmid=0, xid=0xbfc0f59c, flags=0x0
2011-05-04 22:47:11.813114 [9122/3022382832] ax_reg: the application program has started a transaction (TX states S3); this XID '4c495841.a74508954f774509a939ad9580bca2b8.03460325a8fe89a8c8134b6dea4b782e' will be returned
2011-05-04 22:47:11.813631 [9122/3022382832] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:47:11.814037 [9122/3022382832] ax_reg/excp=7/ret_cod=0/errno=2
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 22:47:38.081183 [9126/3022632688] lixa_xa_start
[...]
2011-05-04 22:47:38.124749 [9126/3022632688] lixa_xa_start: resource manager # 0 registers dynamically, skipping...
2011-05-04 22:47:38.125154 [9126/3022632688] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-05-04 22:47:38.125330 [9126/3022632688] lixa_xa_start: sending 210 bytes to the server for step 24
2011-05-04 22:47:38.125654 [9126/3022632688] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table><p>
	Oracle is defined as the first resource manager and calls
	<code class="function">ax_reg</code> using <em class="parameter"><code>rmid=0</code></em>.
	IBM DB2 is defined as the second resource manager and its
	<code class="function">xa_start</code> function is called
	from the LIXA transaction manager using <em class="parameter"><code>rmid=1</code></em>.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The LIXA Transaction Manager skips the first resource manager
	    because it is configured for dynamic registration.
	</p></div><p>
	Using static registration for Oracle and dynamic registration for
	IBM DB2 is easy as well:
	</p><table xmlns="" frame="box" id="id3380281"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA_DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA_DB2_DYN
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:57:37.235541 [9346/3023226608] ax_reg: rmid=1, xid=0xbfcf8880, flags=0x0
2011-05-04 22:57:37.236410 [9346/3023226608] ax_reg: the application program has started a transaction (TX states S3); this XID '4c495841.1bf330d60c0442e4b61539214a413ecb.79fecb55351db58295ebf99c9bf09a70' will be returned
2011-05-04 22:57:37.236859 [9346/3023226608] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:57:37.237581 [9346/3023226608] ax_reg/excp=7/ret_cod=0/errno=2
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 22:58:10.258562 [9350/3022706416] lixa_xa_start
[...]
2011-05-04 22:58:10.296182 [9350/3022706416] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-05-04 22:58:10.296448 [9350/3022706416] lixa_xa_start: resource manager # 1 registers dynamically, skipping...
2011-05-04 22:58:10.296625 [9350/3022706416] lixa_xa_start: sending 210 bytes to the server for step 24
2011-05-04 22:58:10.296990 [9350/3022706416] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table><p>
	Now the roles of Oracle and IBM DB2 swapped. As a final example
	you can try the static registration for Oracle and IBM DB2 too:
	</p><table xmlns="" frame="box" id="id3380325"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA_DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA_DB2_STA
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 23:00:27.871131 [9356/3022927600] lixa_xa_start
[...]
2011-05-04 23:00:27.917087 [9356/3022927600] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-05-04 23:00:27.918251 [9356/3022927600] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-05-04 23:00:27.918741 [9356/3022927600] lixa_xa_start: sending 281 bytes to the server for step 24
2011-05-04 23:00:27.919389 [9356/3022927600] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table><p>
	No resource manager calls <code class="function">ax_reg</code> with this
	configuration: this is exactly what's expected.
      </p><p>
	As a final check, we can verify all the tables have no rows:
	</p><table xmlns="" frame="box" id="id3380363"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table><p>
	</p><table xmlns="" frame="box" id="id3380386"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table><p>
	Congratulations! You have just completed a full discovery of
	a Distributed Transaction Processing example with a simple
	Application Program, LIXA Transaction Manager and two widespread
	Resource Managers: Oracle Database Server and IBM DB2 DBMS.
      </p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example5_pql"></a>An example with PostgreSQL DBMS</h2></div></div></div><div class="figure"><a id="develop5"></a><p class="title"><b>Figure 5.5. Deploy model of an example with PostgreSQL DBMS</b></p><div class="figure-contents"><div class="mediaobject"><img src="LIXA_Development_5.png" alt="Deploy model of an example with PostgreSQL DBMS" /></div></div></div><br class="figure-break" /><p>
      This example was developed using PostgreSQL 8.3.15 for Linux (Ubuntu).
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software, please refer to the 
	official site for your Linux distribution or to the official site
	of PostgreSQL if your operating system does not distribute the
	software or you want to use a different PostgreSQL version.
	Using Ubuntu Linux this packages are necessary:
	</p><div class="variablelist"><dl><dt><span class="term"><span class="package">libpq-dev</span></span></dt><dd><p>
		header files for libpq5 (PostgreSQL library)
	    </p></dd><dt><span class="term"><span class="package">libpq</span></span></dt><dd><p>
		PostgreSQL C client library
	    </p></dd><dt><span class="term"><span class="package">postgresql-client-8.3</span></span></dt><dd><p>
		front-end programs for PostgreSQL 8.3
	    </p></dd><dt><span class="term"><span class="package">postgresql-client-common</span></span></dt><dd><p>
		manager for multiple PostgreSQL client version
	    </p></dd><dt><span class="term"><span class="package">postgresql-8.3</span></span></dt><dd><p>
		object-relational SQL database, version 8.3
	    </p></dd><dt><span class="term"><span class="package">postgresql-common</span></span></dt><dd><p>
		PostgreSQL database-cluster manager
	    </p></dd></dl></div><p>
	This manual does not give you information related
	to PostgreSQL: it is assumed you already installed and
	configured the database.
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	This example requires you are running the database and the application
	on the same host: this is not a technical limitation, but a way to
	make it easy. Client/server configuration must work as well, but
	it needs some PostgreSQL extra configuration: please refer to the
	database documentation.
    </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the PostgreSQL
	server resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_PostgreSQL_environment"></a>Set-up PostgreSQL environment</h3></div></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id3380572"></a>Start-up the PostgreSQL server</h4></div></div></div><p>
	  If your server didn't start-up automatically at boot time, you
	  could start it with the following commands:
	  </p><table xmlns="" frame="box" id="id3380599"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ ps -ef|grep postgres|grep -v grep
tiian@ubuntu:~$ sudo /etc/init.d/postgresql-8.3 start
 * Starting PostgreSQL 8.3 database server                               [ OK ]
tiian@ubuntu:~$ ps -ef|grep postgres|grep -v grep
postgres  6086     1 24 11:25 ?        00:00:01 /usr/lib/postgresql/8.3/bin/postgres -D /var/lib/postgresql/8.3/main -c config_file=/etc/postgresql/8.3/main/postgresql.conf
postgres  6088  6086  0 11:25 ?        00:00:00 postgres: writer process                                                                                        
postgres  6089  6086  0 11:25 ?        00:00:00 postgres: wal writer process                                                                                    
postgres  6090  6086  0 11:25 ?        00:00:00 postgres: autovacuum launcher process                                                                           
postgres  6091  6086  0 11:25 ?        00:00:00 postgres: stats collector process
	    </pre></td></tr></tbody></table><p>
	  Switch to user <code class="systemitem">postgres</code>,
	  associate your user to a matching database user
	  <sup>[<a id="id3380644" href="#ftn.id3380644" class="footnote">18</a>]</sup>
	  ; my personal account is 
	  <code class="systemitem">tiian</code>
	  and I created the same user inside PostgreSQL database:
	  </p><table xmlns="" frame="box" id="id3380670"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ sudo su - postgres
[sudo] password for tiian:
postgres@ubuntu:~$ createuser --createdb tiian
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create more new roles? (y/n) n
	    </pre></td></tr></tbody></table><p>
	  Create a new database and a table necessary to store some data:
	  </p><table xmlns="" frame="box" id="id3380685"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ createdb testdb
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt; CREATE TABLE "authors" (
testdb(&gt; "id" integer NOT NULL,
testdb(&gt; "last_name" text,
testdb(&gt; "first_name" text,
testdb(&gt; Constraint "authors_pkey" Primary Key ("id"));
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "authors_pkey" for table "authors"
CREATE TABLE

testdb=&gt; select * from authors;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	    </pre></td></tr></tbody></table><p>
	  OK, the “<span class="quote">authors</span>” table was created. 
	  If something went wrong, you should refer to PostgreSQL
	  documentation to fix the issue before the next step because
	  you would not be able to execute the sample program without a
	  basic running installation.
	</p></div></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3380730"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><table xmlns="" frame="box" id="id3380738"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	  </pre></td></tr></tbody></table><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3380766"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><table xmlns="" frame="box" id="id3380786"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example5_pql.c .
tiian@ubuntu:~/tmp$ gcc example5_pql.c -Wall \
&gt; -I /opt/lixa/include/ -L /opt/lixa/lib/ -l lixac -l lixapq \
&gt; -I /usr/include/postgresql -l pq \
&gt; -o example5_pql
	  </pre></td></tr></tbody></table><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><table xmlns="" frame="box" id="id3380814"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ldd example5_pql
        linux-gate.so.1 =&gt;  (0xb7701000)
        liblixac.so.0 =&gt; not found
        liblixapq.so.0 =&gt; not found
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb76d1000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7582000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb753d000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb73fb000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb736e000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb736b000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb7341000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb730f000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb72cf000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb72b7000)
        /lib/ld-linux.so.2 (0xb7702000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb72b3000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb729d000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb727a000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb7272000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb726f000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb725c000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb724e000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb7237000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb71c1000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb71b1000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb7164000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb715f000)
	  </pre></td></tr></tbody></table><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3380862"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are two unresolved references to liblixac.so.0 and 
	liblixapq.so.0: they can be fixed 
	setting up the proper environment variable:
	</p><table xmlns="" frame="box" id="id3380872"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/opt/lixa/lib
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/opt/lixa/lib
	  </pre></td></tr></tbody></table><p>
	Check again the executable:
	</p><table xmlns="" frame="box" id="id3380895"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ldd example5_pql
        linux-gate.so.1 =&gt;  (0xb7711000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76f6000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb76ef000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb76c1000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7572000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb756e000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb756a000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb7565000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb755c000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb74aa000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb738a000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb7376000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb735e000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7319000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb71d6000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb7149000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb7146000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb711d000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb70eb000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb70ab000)
        /lib/ld-linux.so.2 (0xb7712000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb7083000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb706e000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb7049000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7045000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb7022000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb7019000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb7016000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb7003000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb6ff6000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb6fdf000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb6f68000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb6f58000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb6f0b000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb6f07000)
	  </pre></td></tr></tbody></table><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><table xmlns="" frame="box" id="id3380955"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=PQL_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
PQL_STA
	  </pre></td></tr></tbody></table><p>
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3380980"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	“<span class="quote">PQL_STA</span>”, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="PQL_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	“<span class="quote">PostgreSQL_stareg</span>”, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the PostgreSQL database is configured for XA
	<sup>[<a id="id3381020" href="#ftn.id3381020" class="footnote">19</a>]</sup>.
      </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id3381045"></a>Program execution</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to “<span class="quote">testdb</span>” PostgreSQL database and the second
	one pointing to the directory where the compiled program
	<code class="filename">example5_pql</code> lives.
	First teminal session:
	</p><table xmlns="" frame="box" id="id3381067"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt; 
	  </pre></td></tr></tbody></table><p>
	Second teminal session:
	</p><table xmlns="" frame="box" id="id3381094"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 21
drwxr-xr-x   2 tiian tiian  112 2011-09-14 21:14 .
drwxrwx--x 101 tiian tiian 5064 2011-09-14 21:13 ..
-rwxr-xr-x   1 tiian tiian 8293 2011-09-13 21:27 example5_pql
-rw-r--r--   1 tiian tiian 3735 2011-09-13 21:26 example5_pql.c
	  </pre></td></tr></tbody></table><p>
	Check the content of “<span class="quote">AUTHORS</span>” table before
	program execution:
	</p><table xmlns="" frame="box" id="id3381122"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table><p>
	Execute the program:
	</p><table xmlns="" frame="box" id="id3381143"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example5_pql insert
Inserting a row in the table...
	  </pre></td></tr></tbody></table><p>
	Check the content of the table again:
	</p><table xmlns="" frame="box" id="id3381164"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
  1 | Foo       | Bar
(1 rows)
	  </pre></td></tr></tbody></table><p>
	The example program inserted the row with id=1. You can not insert
	the same row twice because there is a unique constraint on this table,
	but you can remove the row using
	</p><table xmlns="" frame="box" id="id3381188"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ ./example5_pql delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table><p>
	Check the table content again:
	</p><table xmlns="" frame="box" id="id3381209"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that “<span class="quote">PQL_STA</span>” is associated to static registration
	<sup>[<a id="id3381237" href="#ftn.id3381237" class="footnote">20</a>]</sup>
	.
	Execute the program:
	</p><table xmlns="" frame="box" id="id3381243"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example5_pql insert 2&gt;&amp;1 | grep xa_start
2011-09-14 21:53:13.403943 [9766/3069609728] lixa_xa_start
[...]
2011-09-14 21:53:13.448918 [9766/3069609728] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-09-14 21:53:13.448977 [9766/3069609728] lixa_xa_start: sending 210 bytes to the server for step 24
2011-09-14 21:53:13.449104 [9766/3069609728] lixa_xa_start/excp=10/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table><p>
	Finally, clean up the table again:
	</p><table xmlns="" frame="box" id="id3381272"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre xmlns="http://www.w3.org/1999/xhtml" class="screen">
tiian@ubuntu:~/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu:~/tmp$ ./example5_pql delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table><p>
      </p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id3377659" href="#id3377659" class="para">13</a>] </sup>
	      I put this line
	      <code class="computeroutput">. /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	      in the file <code class="filename">$HOME/.profile</code> of the
	      <code class="systemitem">oracle</code> user to set-up
	      the default administration environment; it complains about
	      two shell errors, but for the sake of our example it's
	      safe.
	  </p></div><div class="footnote"><p><sup>[<a id="ftn.id3378084" href="#id3378084" class="para">14</a>] </sup>
	    The content of <code class="constant">xa_open_info</code> string is
	    described in chapter 15 "Developing Applications with Oracle XA"
	    of the "Oracle Database Application Developer's Guide"
	    manual; please refer to the documentation published by
	    Oracle Corporation for further details.
	</p></div><div class="footnote"><p><sup>[<a id="ftn.id3378860" href="#id3378860" class="para">15</a>] </sup>
	    The content of <code class="constant">xa_open_info</code> string is
	    documented at IBM Infocenter: search the string
	    “<span class="quote">xa_open string formats</span>” in the documentation
	    relevant to your installed version; this is a link
	    <a class="ulink" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html" target="_top">
	      http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html
	    </a>
	    but it may change in the future.
	</p></div><div class="footnote"><p><sup>[<a id="ftn.id3379422" href="#id3379422" class="para">16</a>] </sup>
If you got some errors like these:
<pre class="screen">
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
</pre>
you could edit the file <code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh</code> and substitute 
<code class="computeroutput">#!/bin/sh</code> with
<code class="computeroutput">#!/bin/bash</code> in the first row as explained 
here:
<a class="ulink" href="http://forums.oracle.com/forums/thread.jspa?messageID=1542334" target="_top">http://forums.oracle.com/forums/thread.jspa?messageID=1542334</a>
</p></div><div class="footnote"><p><sup>[<a id="ftn.id3379587" href="#id3379587" class="para">17</a>] </sup>
	    The content of <code class="constant">xa_open_info</code> string is
	    described in chapter 15 "Developing Applications with Oracle XA"
	    of the "Oracle Database Application Developer's Guide"
	    manual; please refer to the documentation published by
	    Oracle Corporation for further details.
	  </p><p>
	    The content of <code class="constant">xa_open_info</code> string is
	    documented at IBM Infocenter: search the string
	    “<span class="quote">xa_open string formats</span>” in the documentation
	    relevant to your installed version; this is a link
	    <a class="ulink" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html" target="_top">
	      http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html
	    </a>
	    but it may change in the future.
	  </p></div><div class="footnote"><p><sup>[<a id="ftn.id3380644" href="#id3380644" class="para">18</a>] </sup>
	      If you wanted to use a database user different than your own
	      UNIX user, as it ever happens when the database is hosted on
	      a different system, you should configure
	      <code class="filename">pg_hba.conf</code> as well. Look at the PostgreSQL
	      documentation to pick up all the necessary details.
	  </p></div><div class="footnote"><p><sup>[<a id="ftn.id3381020" href="#id3381020" class="para">19</a>] </sup>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#id3381463"><span class="citation">XAspec</span></a>].
	</p></div><div class="footnote"><p><sup>[<a id="ftn.id3381237" href="#id3381237" class="para">20</a>] </sup>
	    The current implementation does not support dynamic registration
	    for PostgreSQL.
	</p></div></div></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="Recovery"></a>Chapter 6. Recovery</h2></div></div></div><p>
    [...]
  </p></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id3381307"></a>Chapter 7. In Depth</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#Tracing">Tracing</a></span></dt><dt><span class="section"><a href="#id3381332">Logging</a></span></dt><dt><span class="section"><a href="#id3381342">Automatic and manual recovery</a></span></dt><dt><span class="section"><a href="#Non_root_installation">Non root installation</a></span></dt><dt><span class="section"><a href="#Workload_balanced_environments">Workload balanced environments</a></span></dt></dl></div><p>
    This chapter explains some internal details you can be interested in
    when you are dealing with complex environments.
  </p><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Tracing"></a>Tracing</h2></div></div></div><p>
      [...]
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3381332"></a>Logging</h2></div></div></div><p>
      [...]
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id3381342"></a>Automatic and manual recovery</h2></div></div></div><p>
      [...]
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Non_root_installation"></a>Non root installation</h2></div></div></div><p>
      [...]
    </p></div><div class="section" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Workload_balanced_environments"></a>Workload balanced environments</h2></div></div></div><p>
      [...]
    </p></div></div><div class="bibliography"><div class="titlepage"><div><div><h2 class="title"><a id="id3381381"></a>Bibliography</h2></div></div></div><div class="bibliodiv"><h3 class="title">Books</h3><div class="biblioentry"><a id="id3381393"></a><p>[<abbr class="abbrev">RefModel</abbr>] <span class="copyright">Copyright © 1996 X/Open Company Limited. </span><span class="biblioid">1-85912-170-5. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><i>Distributed Transaction Processing: Reference Model, Version 3</i>. </span></p></div><div class="biblioentry"><a id="id3381428"></a><p>[<abbr class="abbrev">TXspec</abbr>] <span class="copyright">Copyright © 1995 X/Open Company Limited. </span><span class="biblioid">1-85912-094-6. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><i>Distributed Transaction Processing: The TX (Transaction Demarcation) Specification</i>. </span></p></div><div class="biblioentry"><a id="id3381463"></a><p>[<abbr class="abbrev">XAspec</abbr>] <span class="copyright">Copyright © 1991 X/Open Company Limited. </span><span class="biblioid">1-872630-24-3. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><i>Distributed Transaction Processing: The XA Specification</i>. </span></p></div><div class="biblioentry"><a id="id3381498"></a><p>[<abbr class="abbrev">XA+spec</abbr>] <span class="copyright">Copyright © 1994 X/Open Company Limited. </span><span class="biblioid">1-85912-046-6. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><i>Distributed Transaction Processing: The XA+ Specification
      Version 2</i>. </span></p></div></div></div></div></body></html>
