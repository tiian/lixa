AT_BANNER([TX: B.4 Suggested Mapping of Return Codes: Single RM])

AT_SETUP([TX/B.4/0.0])
# The TM opens the RM when the AP calls tx_open( ).
# xa_open( )      tx_open( )
# [XAER_RMERR] -> [TX_ERROR]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/-3
xa_close/0
xa_open/0
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/-3
xa_close/0
xa_open/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh reset start case0018 -6], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0018 -6], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/0.1])
# The TM opens the RM when the AP calls tx_open( ).
# xa_open( )      tx_open( )
# [XAER_INVAL] -> [TX_FAIL]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/-5
xa_close/0
xa_open/0
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/-5
xa_close/0
xa_open/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh noreset none case0018 -7], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0018 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/0.2])
# The TM opens the RM when the AP calls tx_open( ).
# xa_open( )      tx_open( )
# [XAER_PROTO] -> [TX_FAIL]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/-6
xa_close/0
xa_open/0
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/-6
xa_close/0
xa_open/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh noreset none case0018 -7], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0018 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/1.0])
# The TM closes the RM when the AP calls tx_close( ).
# xa_close( )     tx_close( )
# [XAER_RMERR] -> [TX_ERROR]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_close/-3
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/0
xa_close/-3
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh noreset none case0022 -6], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0022 -6], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/1.1])
# The TM closes the RM when the AP calls tx_close( ).
# xa_close( )     tx_close( )
# [XAER_INVAL] -> [TX_FAIL]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_close/-5
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/0
xa_close/-5
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh noreset none case0022 -7], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0022 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/1.2])
# The TM closes the RM when the AP calls tx_close( ).
# xa_close( )     tx_close( )
# [XAER_PROTO] -> [TX_FAIL]
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_close/-6
]])
AT_DATA([monkey1d.conf],
[[# third monkey R.M. config
xa_open/0
xa_close/-6
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0006 ; lixa_test_exec.sh noreset none case0022 -7], [0], [ignore], [ignore])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0022 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.0])
# The [XA_RETRY] code tells the TM to reissue the call. The result the TM
# returns to the AP depends on the ultimate outcome of the reissued call. If
# the RM keeps returning [XA_RETRY], the TM may return [TX_ERROR].
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -6], [0], [ignore], [ignore])
AT_CLEANUP

# These return codes indicate that the global transaction has been marked
# rollbackonly. An RM would never return them when the TM calls xa_start( ) to
# start a new global transaction. An RM only returns these codes when a thread
# of control uses the xa_start(TMRESUME) or xa_start(TMJOIN) forms to resume or
# join an existing global transaction that the RM has marked rollback-only.
# This situation is not applicable here.

AT_SETUP([TX/B.4/2.1])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/100
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.2])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/101
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.3])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/102
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.4])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/103
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.5])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/104
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.6])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/105
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.7])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/106
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.8])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/107
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/2.9])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.10])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -6], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.11])
# XAER_DUPID
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-8
xa_end/0
xa_rollback/0
xa_start/-8
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.12])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.13])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-6
xa_end/0
xa_rollback/0
xa_start/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.14])
# XAER_RMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-7
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/2.15])
# XAER_OUTSIDE
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/-9
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 0 -1], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.0])
# The [XA_RETRY] code tells the TM to reissue the call. The result the TM
# returns to the AP depends on the ultimate outcome of the reissued call. If
# the RM keeps returning [XA_RETRY], the TM may return [TX_ERROR].
#
# LIXA returns TX_NO_BEGIN instead of TX_ERROR: it seems a more appropriate
# return code 
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

# These return codes indicate that the global transaction has been marked
# rollbackonly. An RM would never return them when the TM calls xa_start( ) to
# start a new global transaction. An RM only returns these codes when a thread
# of control uses the xa_start(TMRESUME) or xa_start(TMJOIN) forms to resume or
# join an existing global transaction that the RM has marked rollback-only.
# This situation is not applicable here.

AT_SETUP([TX/B.4/3.1])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/100
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.2])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/101
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.3])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/102
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.4])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/103
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.5])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/104
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.6])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/105
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.7])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/106
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.8])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/107
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/3.9])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.10])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.11])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/100
xa_start/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -102], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.12])
# XAER_DUPID
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-8
xa_end/0
xa_rollback/0
xa_start/-8
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.13])
# XAER_DUPID
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/101
xa_start/-8
xa_end/0
xa_rollback/0
xa_start/-8
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -102], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.14])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.15])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/102
xa_start/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -102], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.16])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-6
xa_end/0
xa_rollback/0
xa_start/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.17])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/103
xa_start/-6
xa_end/0
xa_rollback/0
xa_start/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -102], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.18])
# XAER_RMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-7
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.19])
# XAER_RMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/104
xa_start/-7
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -102], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/3.20])
# XAER_OUTSIDE
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/0
xa_start/-9
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 1 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.0])
# The [XA_RETRY] code tells the TM to reissue the call. The result the TM
# returns to the AP depends on the ultimate outcome of the reissued call. If
# the RM keeps returning [XA_RETRY], the TM may return [TX_ERROR].
#
# LIXA returns TX_NO_BEGIN instead of TX_ERROR: it seems a more appropriate
# return code 
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

# These return codes indicate that the global transaction has been marked
# rollbackonly. An RM would never return them when the TM calls xa_start( ) to
# start a new global transaction. An RM only returns these codes when a thread
# of control uses the xa_start(TMRESUME) or xa_start(TMJOIN) forms to resume or
# join an existing global transaction that the RM has marked rollback-only.
# This situation is not applicable here.

AT_SETUP([TX/B.4/4.1])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/100
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.2])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/101
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.3])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/102
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.4])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/103
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.5])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/104
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.6])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/105
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.7])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/106
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.8])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/107
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP
AT_SETUP([TX/B.4/4.9])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.10])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.11])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_start/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -109], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.12])
# XAER_DUPID
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-8
xa_end/0
xa_rollback/0
xa_start/-8
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.13])
# XAER_DUPID
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_start/-8
xa_end/0
xa_rollback/0
xa_start/-8
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -109], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.14])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.15])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_start/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -109], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.16])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-6
xa_end/0
xa_rollback/0
xa_start/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.17])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_start/-6
xa_end/0
xa_rollback/0
xa_start/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -109], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.18])
# XAER_RMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-7
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.19])
# XAER_RMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_start/-7
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -109], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/4.20])
# XAER_OUTSIDE
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/0
xa_start/-9
xa_end/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0023 2 -100], [0], [ignore], [ignore])
AT_CLEANUP

#
# TX page 65, xa_end() (xa_commit)
#

AT_SETUP([TX/B.4/5.0])
# XA_NOMIGRATE
# this is a case test that reproduce an internal error in the Resource 
# Manager and generates a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/9
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.1])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this step rollbacks the recovery pending transaction of previous case test
# TX/B.4/5.0
xa_commit/6
xa_start/0
xa_end/100
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.2])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/101
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.3])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/102
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.4])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/103
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.5])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/104
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.6])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/105
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.7])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/106
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.8])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/107
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.9])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-4
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.10])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-3
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.11])
# XAER_RMFAIL
# this test case emulates a Resource Manager failure while committing the
# resources
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-7
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.12])
# XAER_INVAL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this recovery pending commit fails due to Resource Manager rollback
xa_commit/104
xa_start/0
xa_end/-5
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/5.13])
# XAER_PROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this recovery pending commit fails due to Resource Manager rollback
xa_commit/103
xa_start/0
xa_end/-6
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

#
# TX page 65, xa_end() (xa_rollback)
#

AT_SETUP([TX/B.4/6.0])
# XA_NOMIGRATE
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this recovery pending commit fails due to Resource Manager rollback
xa_commit/100
xa_start/0
xa_end/9
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.1])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this is a recovery pending rollback from the previous transaction
xa_rollback/0
xa_start/0
xa_end/100
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.2])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/101
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.3])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/102
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.4])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/103
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.5])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/104
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.6])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/105
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.7])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/106
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.8])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/107
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.9])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-4
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.10])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-3
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.11])
# XAER_RMFAIL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/-7
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.12])
# XAER_INVAL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to recovery pending transaction
xa_rollback/6
xa_start/0
xa_end/-5
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/6.13])
# XAER_PROTO
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to recovery pending transaction
xa_rollback/6
xa_start/0
xa_end/-6
xa_rollback/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

#
# TX page 66, xa_commit()
#

AT_SETUP([TX/B.4/7.0])
# XA_HEURCOM
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to recovery pending transaction
xa_rollback/0
xa_start/0
xa_end/0
xa_commit/7
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.1])
# XA_HEURRB
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/6
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.2])
# XA_HEURHAZ
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/8
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -4], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.3])
# XA_HEURMIX
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/8
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -4], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.4])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/100
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.5])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/101
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.6])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/102
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.7])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/103
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.8])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/104
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.9])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/105
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.10])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/106
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.11])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/107
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.12])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.13])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/-4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -2], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.14])
# XAER_RMFAIL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_commit/-7
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.15])
# XAER_INVAL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this commit is related to previuos recovery pending transaction
xa_commit/0
xa_start/0
xa_end/0
xa_commit/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.16])
# XAER_PROTO
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this commit is related to previuos recovery pending transaction
xa_commit/7
xa_start/0
xa_end/0
xa_commit/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/7.17])
# XA_RETRY
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this commit is related to previuos recovery pending transaction
xa_commit/7
xa_start/0
xa_end/0
xa_commit/4
xa_commit/4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 1 -6], [0], [ignore], [ignore])
AT_CLEANUP

#
# TX page 66, xa_rollback()
#

AT_SETUP([TX/B.4/8.0])
# XA_HEURCOM
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this commit is related to previuos recovery pending transaction
xa_commit/6
xa_start/0
xa_end/0
xa_rollback/7
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -9], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.1])
# XA_HEURRB
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/6
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.2])
# XA_HEURHAZ
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/8
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -4], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.3])
# XA_HEURMIX
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/8
xa_forget/0
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -4], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.4])
# XA_RBROLLBACK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/100
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.5])
# XA_RBCOMMFAIL
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/101
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.6])
# XA_RBDEADLOCK
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/102
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.7])
# XA_RBINTEGRITY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/103
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.8])
# XA_RBOTHER
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/104
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.9])
# XA_RBPROTO
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/105
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.10])
# XA_RBTIMEOUT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/106
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.11])
# XA_RBTRANSIENT
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/107
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.12])
# XAER_RMERR
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/-3
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.13])
# XAER_NOTA
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/-4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 0], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.14])
# XAER_RMFAIL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
xa_start/0
xa_end/0
xa_rollback/-7
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.15])
# XAER_INVAL
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to previous (recovery pending) transaction
xa_rollback/0
xa_start/0
xa_end/0
xa_rollback/-5
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.16])
# XAER_PROTO
# this test case generate a recovery pending transaction
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to previous (recovery pending) transaction
xa_rollback/0
xa_start/0
xa_end/0
xa_rollback/-6
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset none case0024 2 -7], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([TX/B.4/8.17])
# XA_RETRY
AT_DATA([monkey1s.conf],
[[# first monkey R.M. config
xa_open/0
# this rollback is related to previous (recovery pending) transaction
xa_rollback/0
xa_start/0
xa_end/0
xa_rollback/4
xa_rollback/4
xa_commit/4
xa_close/0
]])
AT_CHECK([export LIXA_PROFILE=CASE_PROF_0007 ; lixa_test_exec.sh noreset stop case0024 2 -6], [0], [ignore], [ignore])
AT_CLEANUP

